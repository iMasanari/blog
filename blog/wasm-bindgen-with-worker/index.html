<!DOCTYPE html><html lang="ja-JP" prefix="og: http://ogp.me/ns#"><head><script src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74494516-4")</script><link href="/bundle.cd5519cdeb.js" rel="preload" as="script"><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><title>Rust + wasm-bindgen + WebWorkerの環境構築 - Tech SANDBOX</title><style>
  body{font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-weight:300;font-size:16px;margin:0;padding:0}a{text-decoration:none;color:#108db8;font-weight:700}h2{border-bottom:1px solid #6c6c6c;border-right:1px solid #6c6c6c;padding-left:.5em}.App{display:flex;flex-direction:column;min-height:100vh}.content{flex:1;box-sizing:border-box;width:100%;max-width:700px;padding:0 1rem;margin:2rem auto}.Header{background:#108db8;box-shadow:0 5px 15px -5px rgba(0,0,0,.8)}.Header-title{margin:0;padding:1rem;text-align:center}.Header-title a{color:#fff}.PostTags{padding:0;margin:0}.PostTags:before{content:"tags: "}.PostTags-li{display:inline;padding:0}.PostTags-Link{color:#6c6c6c}
</style>
<link href="/bundle.cd5519cdeb.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="/bundle.cd5519cdeb.css" rel="stylesheet"></noscript>
<script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script><meta content="Rust + wasm-bindgen + WebWorkerの環境構築 - Tech SANDBOX" name="description"><meta content="Rust + wasm-bindgen + WebWorkerの環境構築 - Tech SANDBOX" property="og:title"><meta content="article" property="og:type"><meta content="Rust + wasm-bindgen + WebWorkerの環境構築 - Tech SANDBOX" property="og:description"><meta content="https://imasanari.github.io/blog/wasm-bindgen-with-worker/" property="og:url"><meta content="https://imasanari.github.io/images/icon.jpg" property="og:image"><meta content="summary" name="twitter:card"></head><body><div class="App"><header class="Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="content"><div><article><span>2018-12-20</span><h1>Rust + wasm-bindgen + WebWorkerの環境構築</h1><ul class="PostTags"><li class="PostTags-li"><a href="/tags/Rust/" class="PostTags-Link">Rust</a> </li><li class="PostTags-li"><a href="/tags/wasm-bindgen/" class="PostTags-Link">wasm-bindgen</a> </li></ul><div><p><a href="https://qiita.com/advent-calendar/2018/wasm" rel="noopener" target="_blank">WebAssembly Advent Calendar 2018</a>の20日目の記事。</p><h2>TL;DR</h2><p>parcelのparcel-plugin-wasm.rsプラグインを使用しよう！</p><p>サンプルリポジトリはこちら<br><a href="https://github.com/iMasanari/wasm-bindgen-with-worker" rel="noopener" target="_blank">iMasanari/wasm-bindgen-with-worker</a></p><h2>やりたいこと</h2><p>時間のかかる処理をWebAssemblyで高速に行いたい。そのためには、下記の条件が必要になる。</p><ul><li>引数や戻り値をJSON形式でやりとりできること</li><li>非同期処理であること</li></ul><p>今回は、Rust(wasm-bindgen)をWebWorkerで動かす環境を作っていく。</p><h2>1度、WebPackで構築するも……</h2><p>まずは、<a href="https://www.mizdra.net/entry/2018/10/17/080000" rel="noopener" target="_blank">WebAssemblyを使って乱数調整ツールをWebに移植した話</a>を元に、WebPackで構築した。しかし、3つの気になる点が出てきた。</p><ul><li>Worker用のエントリーファイルをもう1つ用意しなければならない<ul><li><a href="https://github.com/webpack/webpack/issues/7647" rel="noopener" target="_blank">Cannot import wasm in web workers #7647</a></li></ul></li><li>中間ファイル生成（Rust→wasm）のせいで、ビルドタスクが煩雑になる</li></ul><p>エントリーファイルの件は増えることより、1つだけハッシュのないファイルが存在することに違和感を持った。<br>普段はRollup.jsでのビルドのため、ハッシュをつけることは基本ないが……</p><h2>parcelでの環境構築</h2><p>parcelで同じ環境を構築したところ、上記の問題を解決することができた。<br>ライブリロードが安定していない気がするが、ライブリロード使わないRollup.jsユーザーなのでそこまで問題は感じていない。</p><p>parcelでWebWorker + WebAssemblyは検索で出てこなかったので、その方法を共有する。</p><h2>各種インストール</h2><p>Node.jsやRustはインストール済みとする。</p><p>parcelのインストール</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -D parcel-bundler parcel-plugin-wasm.rs
</code></pre><p>parcel-plugin-wasm.rsはRustをwasm-packでコンパイルするためのparcelのプラグイン。wasm-packのインストールがまだの場合はインストールする。</p><pre class="language-bash"><code class="language-bash">$ cargo <span class="token function">install</span> wasm-pack
</code></pre><p>個人的にいつもTypeScriptを使うので、それ関連のインストール。<br><a href="https://www.npmjs.com/package/@types/webassembly-js-api" rel="noopener" target="_blank">@types/webassembly-js-api</a>は、WebAssemblyの型定義。</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -D typescript @types/webassembly-js-api
</code></pre><h2>設定ファイル</h2><p>srcフォルダの構造と各種設定ファイル（必要最低限の箇所のみ）はこんな感じ。</p><pre class="language-bash"><code class="language-bash">$ tree src --dirsfirst
src
├── app
│   └── index.ts
├── wasm
│   ├── lib.rs
│   └── lib.rs.d.ts
├── worker
│   └── index.ts
└── index.html
</code></pre><p>ちなみにこの出力をするためにMacへTreeコマンドを入れた。</p><pre class="language-json"><code class="language-json">// package.json
<span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"parcel src/index.html"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"parcel build src/index.html --public-url ."</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@types/webassembly-js-api"</span><span class="token operator">:</span> <span class="token string">"0.0.2"</span><span class="token punctuation">,</span>
    <span class="token property">"parcel-bundler"</span><span class="token operator">:</span> <span class="token string">"^1.10.3"</span><span class="token punctuation">,</span>
    <span class="token property">"parcel-plugin-wasm.rs"</span><span class="token operator">:</span> <span class="token string">"^1.2.6"</span><span class="token punctuation">,</span>
    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^3.2.2"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"last 2 chrome versions"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><pre class="language-toml"><code class="language-toml"># Cargo.toml
[package]
name = "wasm"
version = "0.1.0"

[dependencies]
wasm-bindgen = "^0.2"

[lib]
crate-type = ["cdylib"]
path = "./src/wasm/lib.rs"
</code></pre><pre class="language-json"><code class="language-json">// tsconfig.json
<span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es2015"</span><span class="token punctuation">,</span>
    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"es2015"</span><span class="token punctuation">,</span>
      <span class="token string">"dom"</span><span class="token punctuation">,</span>
      <span class="token string">"webworker"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>WebAssemblyはIEでは使えないので、TypeScriptのコンパイルはes2015で行っている。parcelのbabel側で変換されないよう、<code>package.json</code>では<code>browserslist</code>の設定を行う。</p><h2>各ファイル</h2><p>全部書くのも面倒なので、各ファイルのインポート部分だけ書いていく。<br>書き足している場所もあるが、全体はサンプルリポジトリを参照。<br><a href="https://github.com/iMasanari/wasm-bindgen-with-worker" rel="noopener" target="_blank">iMasanari/wasm-bindgen-with-worker</a></p><pre class="language-html"><code class="language-html"><span class="token comment">&lt;!-- src/index.html --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>app/index.ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token language-javascript script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/app/index.ts</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'../worker/index.ts'</span><span class="token punctuation">)</span>
</code></pre><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/worker/index.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> wasm <span class="token keyword">from</span> <span class="token string">'../wasm/lib.rs'</span>

<span class="token comment">// WebAssemblyの実行</span>
wasm<span class="token punctuation">.</span><span class="token function">some_function</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span>
</code></pre><p>あとは、Rustの関数を作るだけ。<br>現在のWebAssemblyは数値しかやりとりができないが、wasm-bindgenを使うことで文字列やJSONもやりとりができるようになる。</p><pre class="language-rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> wasm_bindgen<span class="token punctuation">;</span>
<span class="token keyword">use</span> wasm_bindgen<span class="token punctuation">:</span><span class="token punctuation">:</span>prelude<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token attr-name attribute">#[wasm_bindgen]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">some_function</span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> JsValue <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><p>ビルドも下記コマンドだけでOK。<br>初回だけ、Rustのビルドに時間がかかる。</p><pre class="language-bash"><code class="language-bash"><span class="token comment"># デバッグ用ビルド + サーバー</span>
$ <span class="token function">npm</span> run dev
</code></pre><pre class="language-bash"><code class="language-bash"><span class="token comment"># プロダクションビルド</span>
$ <span class="token function">npm</span> run build
</code></pre><h2>まとめ</h2><p>まだ書きたいことはあるが、日付を超えてしまったので一旦ここまで。<br>後日、追記または別記事という形で公開していきたい。</p><p>parcelを使うことで、簡単にWebAssemblyが始められる。</p><p>ちなみにRustは、C言語並みの処理スピードを持ちながらモダンな文法と強力なコンパイル時チェックを備えている言語でおすすめ！　所有権、借用、ライフタイム？　学習コストが高い？　知らんな。一緒に<a href="https://doc.rust-jp.rs/the-rust-programming-language-ja/1.6/book/references-and-borrowing.html#概論" rel="noopener" target="_blank">借用チェッカと戦おうぜ！</a> by Rust初心者</p></div></article><div class="PostPager"><div class="PostPager-item"></div><div class="PostPager-item"><a href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/difference-between-jsx-and-html/">HTMLでは使えないJSX独自の書き方</a></div></div></div></div><footer class="Footer"><p>Author: <a href="https://github.com/iMasanari">iMasanari</a></p><small><a href="https://github.com/iMasanari/imasanari.github.io/">&gt; Blog Repository &lt;</a></small></footer></div><script>var __data={component:1,title:"Rust + wasm-bindgen + WebWorkerの環境構築 - Tech SANDBOX",props:{post:{title:"Rust + wasm-bindgen + WebWorkerの環境構築",description:null,slug:"wasm-bindgen-with-worker",tags:["Rust","wasm-bindgen"],date:"2018-12-20",contents:"<p><a href=https://qiita.com/advent-calendar/2018/wasm rel=noopener target=_blank>WebAssembly Advent Calendar 2018</a>の20日目の記事。</p><h2>TL;DR</h2><p>parcelのparcel-plugin-wasm.rsプラグインを使用しよう！</p><p>サンプルリポジトリはこちら<br><a href=https://github.com/iMasanari/wasm-bindgen-with-worker rel=noopener target=_blank>iMasanari/wasm-bindgen-with-worker</a></p><h2>やりたいこと</h2><p>時間のかかる処理をWebAssemblyで高速に行いたい。そのためには、下記の条件が必要になる。</p><ul><li>引数や戻り値をJSON形式でやりとりできること</li><li>非同期処理であること</li></ul><p>今回は、Rust(wasm-bindgen)をWebWorkerで動かす環境を作っていく。</p><h2>1度、WebPackで構築するも……</h2><p>まずは、<a href=https://www.mizdra.net/entry/2018/10/17/080000 rel=noopener target=_blank>WebAssemblyを使って乱数調整ツールをWebに移植した話</a>を元に、WebPackで構築した。しかし、3つの気になる点が出てきた。</p><ul><li>Worker用のエントリーファイルをもう1つ用意しなければならない<ul><li><a href=https://github.com/webpack/webpack/issues/7647 rel=noopener target=_blank>Cannot import wasm in web workers #7647</a></li></ul></li><li>中間ファイル生成（Rust→wasm）のせいで、ビルドタスクが煩雑になる</li></ul><p>エントリーファイルの件は増えることより、1つだけハッシュのないファイルが存在することに違和感を持った。<br>普段はRollup.jsでのビルドのため、ハッシュをつけることは基本ないが……</p><h2>parcelでの環境構築</h2><p>parcelで同じ環境を構築したところ、上記の問題を解決することができた。<br>ライブリロードが安定していない気がするが、ライブリロード使わないRollup.jsユーザーなのでそこまで問題は感じていない。</p><p>parcelでWebWorker + WebAssemblyは検索で出てこなかったので、その方法を共有する。</p><h2>各種インストール</h2><p>Node.jsやRustはインストール済みとする。</p><p>parcelのインストール</p><pre class=language-bash><code class=language-bash>$ <span class='token function'>npm</span> <span class='token function'>install</span> -D parcel-bundler parcel-plugin-wasm.rs\n</code></pre><p>parcel-plugin-wasm.rsはRustをwasm-packでコンパイルするためのparcelのプラグイン。wasm-packのインストールがまだの場合はインストールする。</p><pre class=language-bash><code class=language-bash>$ cargo <span class='token function'>install</span> wasm-pack\n</code></pre><p>個人的にいつもTypeScriptを使うので、それ関連のインストール。<br><a href=https://www.npmjs.com/package/@types/webassembly-js-api rel=noopener target=_blank>@types/webassembly-js-api</a>は、WebAssemblyの型定義。</p><pre class=language-bash><code class=language-bash>$ <span class='token function'>npm</span> <span class='token function'>install</span> -D typescript @types/webassembly-js-api\n</code></pre><h2>設定ファイル</h2><p>srcフォルダの構造と各種設定ファイル（必要最低限の箇所のみ）はこんな感じ。</p><pre class=language-bash><code class=language-bash>$ tree src --dirsfirst\nsrc\n├── app\n│   └── index.ts\n├── wasm\n│   ├── lib.rs\n│   └── lib.rs.d.ts\n├── worker\n│   └── index.ts\n└── index.html\n</code></pre><p>ちなみにこの出力をするためにMacへTreeコマンドを入れた。</p><pre class=language-json><code class=language-json>// package.json\n<span class='token punctuation'>{</span>\n  <span class='token property'>\"scripts\"</span><span class='token operator'>:</span> <span class='token punctuation'>{</span>\n    <span class='token property'>\"serve\"</span><span class='token operator'>:</span> <span class='token string'>\"parcel src/index.html\"</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"build\"</span><span class='token operator'>:</span> <span class='token string'>\"parcel build src/index.html --public-url .\"</span><span class='token punctuation'>,</span>\n  <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n  <span class='token property'>\"devDependencies\"</span><span class='token operator'>:</span> <span class='token punctuation'>{</span>\n    <span class='token property'>\"@types/webassembly-js-api\"</span><span class='token operator'>:</span> <span class='token string'>\"0.0.2\"</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"parcel-bundler\"</span><span class='token operator'>:</span> <span class='token string'>\"^1.10.3\"</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"parcel-plugin-wasm.rs\"</span><span class='token operator'>:</span> <span class='token string'>\"^1.2.6\"</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"typescript\"</span><span class='token operator'>:</span> <span class='token string'>\"^3.2.2\"</span>\n  <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n  <span class='token property'>\"browserslist\"</span><span class='token operator'>:</span> <span class='token punctuation'>[</span>\n    <span class='token string'>\"last 2 chrome versions\"</span>\n  <span class='token punctuation'>]</span>\n<span class='token punctuation'>}</span>\n</code></pre><pre class=language-toml><code class=language-toml># Cargo.toml\n[package]\nname = \"wasm\"\nversion = \"0.1.0\"\n\n[dependencies]\nwasm-bindgen = \"^0.2\"\n\n[lib]\ncrate-type = [\"cdylib\"]\npath = \"./src/wasm/lib.rs\"\n</code></pre><pre class=language-json><code class=language-json>// tsconfig.json\n<span class='token punctuation'>{</span>\n  <span class='token property'>\"compilerOptions\"</span><span class='token operator'>:</span> <span class='token punctuation'>{</span>\n    <span class='token property'>\"target\"</span><span class='token operator'>:</span> <span class='token string'>\"es2015\"</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"lib\"</span><span class='token operator'>:</span> <span class='token punctuation'>[</span>\n      <span class='token string'>\"es2015\"</span><span class='token punctuation'>,</span>\n      <span class='token string'>\"dom\"</span><span class='token punctuation'>,</span>\n      <span class='token string'>\"webworker\"</span>\n    <span class='token punctuation'>]</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"strict\"</span><span class='token operator'>:</span> <span class='token boolean'>true</span><span class='token punctuation'>,</span>\n    <span class='token property'>\"esModuleInterop\"</span><span class='token operator'>:</span> <span class='token boolean'>true</span>\n  <span class='token punctuation'>}</span>\n<span class='token punctuation'>}</span>\n</code></pre><p>WebAssemblyはIEでは使えないので、TypeScriptのコンパイルはes2015で行っている。parcelのbabel側で変換されないよう、<code>package.json</code>では<code>browserslist</code>の設定を行う。</p><h2>各ファイル</h2><p>全部書くのも面倒なので、各ファイルのインポート部分だけ書いていく。<br>書き足している場所もあるが、全体はサンプルリポジトリを参照。<br><a href=https://github.com/iMasanari/wasm-bindgen-with-worker rel=noopener target=_blank>iMasanari/wasm-bindgen-with-worker</a></p><pre class=language-html><code class=language-html><span class='token comment'>&lt;!-- src/index.html --\x3e</span>\n<span class='token tag'><span class='token tag'><span class='token punctuation'>&lt;</span>script</span> <span class='token attr-name'>src</span><span class='token attr-value'><span class='token punctuation'>=</span><span class='token punctuation'>\"</span>app/index.ts<span class='token punctuation'>\"</span></span><span class='token punctuation'>></span></span><span class='token language-javascript script'></span><span class='token tag'><span class='token tag'><span class='token punctuation'>&lt;/</span>script</span><span class='token punctuation'>></span></span>\n</code></pre><pre class=language-typescript><code class=language-typescript><span class='token comment'>// src/app/index.ts</span>\n<span class='token keyword'>const</span> worker <span class='token operator'>=</span> <span class='token keyword'>new</span> <span class='token class-name'>Worker</span><span class='token punctuation'>(</span><span class='token string'>'../worker/index.ts'</span><span class='token punctuation'>)</span>\n</code></pre><pre class=language-typescript><code class=language-typescript><span class='token comment'>// src/worker/index.ts</span>\n<span class='token keyword'>import</span> <span class='token operator'>*</span> <span class='token keyword'>as</span> wasm <span class='token keyword'>from</span> <span class='token string'>'../wasm/lib.rs'</span>\n\n<span class='token comment'>// WebAssemblyの実行</span>\nwasm<span class='token punctuation'>.</span><span class='token function'>some_function</span><span class='token punctuation'>(</span><span class='token string'>'run'</span><span class='token punctuation'>)</span>\n</code></pre><p>あとは、Rustの関数を作るだけ。<br>現在のWebAssemblyは数値しかやりとりができないが、wasm-bindgenを使うことで文字列やJSONもやりとりができるようになる。</p><pre class=language-rust><code class=language-rust><span class='token keyword'>extern</span> <span class='token keyword'>crate</span> wasm_bindgen<span class='token punctuation'>;</span>\n<span class='token keyword'>use</span> wasm_bindgen<span class='token punctuation'>:</span><span class='token punctuation'>:</span>prelude<span class='token punctuation'>:</span><span class='token punctuation'>:</span><span class='token operator'>*</span><span class='token punctuation'>;</span>\n\n<span class='token attr-name attribute'>#[wasm_bindgen]</span>\n<span class='token keyword'>pub</span> <span class='token keyword'>fn</span> <span class='token function'>some_function</span><span class='token punctuation'>(</span>arg<span class='token punctuation'>:</span> <span class='token operator'>&amp;</span>str<span class='token punctuation'>)</span> <span class='token punctuation'>-></span> JsValue <span class='token punctuation'>{</span>\n    <span class='token comment'>// ...</span>\n<span class='token punctuation'>}</span>\n</code></pre><p>ビルドも下記コマンドだけでOK。<br>初回だけ、Rustのビルドに時間がかかる。</p><pre class=language-bash><code class=language-bash><span class='token comment'># デバッグ用ビルド + サーバー</span>\n$ <span class='token function'>npm</span> run dev\n</code></pre><pre class=language-bash><code class=language-bash><span class='token comment'># プロダクションビルド</span>\n$ <span class='token function'>npm</span> run build\n</code></pre><h2>まとめ</h2><p>まだ書きたいことはあるが、日付を超えてしまったので一旦ここまで。<br>後日、追記または別記事という形で公開していきたい。</p><p>parcelを使うことで、簡単にWebAssemblyが始められる。</p><p>ちなみにRustは、C言語並みの処理スピードを持ちながらモダンな文法と強力なコンパイル時チェックを備えている言語でおすすめ！　所有権、借用、ライフタイム？　学習コストが高い？　知らんな。一緒に<a href=https://doc.rust-jp.rs/the-rust-programming-language-ja/1.6/book/references-and-borrowing.html#概論 rel=noopener target=_blank>借用チェッカと戦おうぜ！</a> by Rust初心者</p>"},next:{title:"HTMLでは使えないJSX独自の書き方",slug:"difference-between-jsx-and-html"}}}</script><script src="/bundle.cd5519cdeb.js"></script></body></html>