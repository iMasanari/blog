<!DOCTYPE html><html lang="ja-JP" prefix="og: http://ogp.me/ns#"><head><link href="/src.9be82b6d.js" rel="preload" as="script"><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><style>
  *,:after,:before{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%}article,header,section{display:block}body{margin:0;font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-size:1rem;font-weight:300;line-height:1.5;color:#212529;text-align:left;background-color:#fff}h1,h2{margin-top:0;margin-bottom:.5rem}p{margin-top:0;margin-bottom:1rem}ul{margin-bottom:1rem}ul{margin-top:0}a{color:#007bff;text-decoration:none;background-color:transparent}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}pre{margin-top:0;margin-bottom:1rem;overflow:auto}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}.nes-container.is-rounded,.nes-container.is-rounded.is-dark{border-style:solid;border-width:4px}.nes-container{position:relative;padding:1.5rem 2rem;border:4px solid #000}.nes-container>:last-child{margin-bottom:0}.nes-container.with-title>.title{display:table;padding:0 .5rem;margin:-1.8rem 0 1rem;font-size:1rem;background-color:#fff}.nes-container.is-dark{position:relative;margin:4px;color:#fff;background-color:#212529;border-color:#fff}.nes-container.is-dark:after{position:absolute;top:-7.2px;right:-7.2px;bottom:-7.2px;left:-7.2px;z-index:-1;content:"";background-color:#212529}.nes-container.is-rounded{border-image-slice:3;border-image-width:3;border-image-repeat:stretch;border-image-source:url('data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8" ?><svg version="1.1" width="8" height="8" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 h1 v1 h-1 z M4 1 h1 v1 h-1 z M2 2 h1 v1 h-1 z M5 2 h1 v1 h-1 z M1 3 h1 v1 h-1 z M6 3 h1 v1 h-1 z M1 4 h1 v1 h-1 z M6 4 h1 v1 h-1 z M2 5 h1 v1 h-1 z M5 5 h1 v1 h-1 z M3 6 h1 v1 h-1 z M4 6 h1 v1 h-1 z" fill="rgb(33,37,41)" /></svg>');border-image-outset:2;padding:1rem 1.5rem;margin:4px}@media (-webkit-min-device-pixel-ratio:0) and (min-resolution:0.001dpcm){.nes-container.is-rounded{border-image-repeat:space}}@supports (-moz-appearance:meterbar){.nes-container.is-rounded{border-image-repeat:stretch}}.nes-container.is-rounded.with-title>.title{margin-top:-1.5rem}.nes-container.is-rounded.is-dark{border-image-slice:3;border-image-width:3;border-image-repeat:stretch;border-image-source:url('data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8" ?><svg version="1.1" width="8" height="8" xmlns="http://www.w3.org/2000/svg"><path d="M3 1 h1 v1 h-1 z M4 1 h1 v1 h-1 z M2 2 h1 v1 h-1 z M5 2 h1 v1 h-1 z M1 3 h1 v1 h-1 z M6 3 h1 v1 h-1 z M1 4 h1 v1 h-1 z M6 4 h1 v1 h-1 z M2 5 h1 v1 h-1 z M5 5 h1 v1 h-1 z M3 6 h1 v1 h-1 z M4 6 h1 v1 h-1 z" fill="rgb(255,255,255)" /></svg>');border-image-outset:0}@media (-webkit-min-device-pixel-ratio:0) and (min-resolution:0.001dpcm){.nes-container.is-rounded.is-dark{border-image-repeat:space}}@supports (-moz-appearance:meterbar){.nes-container.is-rounded.is-dark{border-image-repeat:stretch}}.nes-container.is-rounded.is-dark:after{content:none}.nes-container.is-rounded{margin-bottom:32px}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}pre[class*=language-]{background:#f5f2f0}.token.comment{color:#708090}.token.punctuation{color:#999}.token.number{color:#905}.token.string{color:#690}.token.operator{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.operator{background:initial}pre[class*=language-]{margin-bottom:1rem}@media (max-width:500px){.shared-main-container{padding:0 4px;border:none}}code{padding:.1em .4em;background-color:#eee;border-radius:3px}.PostTags,.PostTags-li{display:inline;padding:0;margin:0}.PostTags-Link{color:#6c6c6c}.Post-header{margin-bottom:32px}@media (max-width:500px){.Post-header{padding-right:16px;padding-left:16px}}.Header{background:#108db8;box-shadow:0 5px 15px -5px rgba(0,0,0,.8);margin:0!important}.Header-title{padding:1rem;text-align:center}.Header-title a{color:#fff}.App{display:flex;flex-direction:column;min-height:100vh}.App-content{flex:1;box-sizing:border-box;width:100%;max-width:700px;margin:2rem auto}
</style>
<link href="/src.390a82d0.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="/src.390a82d0.css" rel="stylesheet"></noscript>
<script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script><script src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74494516-4")</script><title>ブログ開発をParcelに変更した - Tech SANDBOX</title><meta content="前回の記事でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。決め手は、Tree Shakingがサポートされていたから。" name="description"><meta content="ブログ開発をParcelに変更した - Tech SANDBOX" property="og:title"><meta content="article" property="og:type"><meta content="前回の記事でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。決め手は、Tree Shakingがサポートされていたから。" property="og:description"><meta content="https://imasanari.github.io/blog/use-parcel/" property="og:url"><meta content="https://imasanari.github.io/images/icon.jpg" property="og:image"><meta content="summary" name="twitter:card"></head><body> <div id="app"><div class="App"><header class="nes-container is-rounded is-dark Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="App-content"><div><article class="nes-container shared-main-container"><div class="Post-header"><span>2019-04-26</span><h1>ブログ開発をParcelに変更した</h1><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/parcel/" class="PostTags-Link">#parcel</a></li><li class="PostTags-li"> <a href="/tags/blog/" class="PostTags-Link">#blog</a></li></ul></div><div><section class="nes-container is-rounded with-title"><p><a href="/blog/wasm-bindgen-with-worker/">前回の記事</a>でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。</p><p>理由は以下の2つ。</p><ul><li>フラットなコンパイルが（実験的に）サポートされていたから</li><li>ビルドスクリプトの見直し（分割化）</li></ul></section><section class="nes-container is-rounded with-title"><h2 class="title">フラットなコンパイル</h2><p>Tree Shakingがサポートされていたため。<code>--experimental-scope-hoisting</code>で有効にできる。<br>しかも普段使っているrollup.jsと同じ、フラットなコンパイルである。</p><p>というのも、今までのバンドルでは各ファイルのスコープを保つため、それぞれのファイルを<code>function</code>で囲っていた。</p><pre class="language-js"><code class="language-js"><span class="token comment">// フラットでないバンドル結果のイメージ</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// boostrap code</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'module.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">export</span><span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function function-variable">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b

    <span class="token keyword">export</span><span class="token punctuation">.</span>add <span class="token operator">=</span> add
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'main.js'</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">export</span><span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'module.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>それが、こうなる。</p><pre class="language-js"><code class="language-js"><span class="token comment">// フラットなバンドル結果のイメージ</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// module.js</span>
  <span class="token keyword">const</span> <span class="token function function-variable">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b
  <span class="token comment">// main.js</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>各ファイルのfunctionスコープがなくなり、バンドル結果がコンパクトになっているのがわかる。もしトップレベルの変数名が他ファイルの変数と被っても自動でリネームしてくれる。<br>ただ、オプション名の「experimental」からわかるように実験的なサポートのため、特殊なことを行おうとするとうまくビルドされない可能性がある。前回の記事の<a href="/blog/wasm-bindgen-with-worker/">WebAssembly</a>ではできなかった。</p></section><section class="nes-container is-rounded with-title"><h2 class="title">ビルドスクリプトの見直し（分割化）</h2><p>変更前では、ビルドスクリプトが1本だったので記事をプレビューする場合でもプログラム全体をコンパイルする必要があった。</p><p>現在は、記事のビルド（ts-node）とプログラムのビルド（parcel）を分離して記事単独でビルドできるようにした。また、watchビルドに対応し、コマンドを叩く必要がなくなった。</p></section><section class="nes-container is-rounded with-title"><h2 class="title">今後</h2><p>rollup.jsでは非対応だったDynamic Importで記事fetchをしてみたい。そうすると、React Suspence使ってみたいからReactに書き換えるかもしれない。</p></section></div></article><div class="PostPager"><div class="PostPager-item"></div><div class="PostPager-item"><a href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/wasm-bindgen-with-worker/">Rust + wasm-bindgen + WebWorkerの環境構築</a></div></div><aside class="nes-container with-title"><div class="title"><span class="AsidePosts-title">同じタグを含む記事</span><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/parcel/" class="PostTags-Link">#parcel</a></li><li class="PostTags-li"> <a href="/tags/blog/" class="PostTags-Link">#blog</a></li></ul></div><ul class="AsidePosts-ul"><li class="AsidePosts-li"><a href="/blog/wasm-bindgen-with-worker/">Rust + wasm-bindgen + WebWorkerの環境構築</a><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/parcel/" class="PostTags-Link">#parcel</a></li></ul></li><li class="AsidePosts-li"><a href="/blog/use-hyperapp/">ブログをHyperappベースの自作ジェネレータに変更した話</a><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/blog/" class="PostTags-Link">#blog</a></li></ul></li><li class="AsidePosts-li"><a href="/blog/use-technology/">ブログで使用した技術</a><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/blog/" class="PostTags-Link">#blog</a></li></ul></li><li class="AsidePosts-li"><a href="/blog/first-post/">react-strictでブログ作成しました</a><ul class="PostTags"><li class="PostTags-li"> <a href="/tags/blog/" class="PostTags-Link">#blog</a></li></ul></li></ul></aside></div></div><footer class="nes-container is-rounded is-dark Footer"><p>Author: <a href="https://github.com/iMasanari">iMasanari</a></p><small><a href="https://github.com/iMasanari/imasanari.github.io/">> Blog Repository &lt;</a></small></footer></div></div><script>var __data={component:1,title:"ブログ開発をParcelに変更した - Tech SANDBOX",props:{post:{title:"ブログ開発をParcelに変更した",description:"前回の記事でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。決め手は、Tree Shakingがサポートされていたから。",slug:"use-parcel",tags:["parcel","blog"],date:"2019-04-26",contents:"<section class='is-rounded nes-container with-title'><p><a href=/blog/wasm-bindgen-with-worker/ >前回の記事</a>でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。</p><p>理由は以下の2つ。</p><ul><li>フラットなコンパイルが（実験的に）サポートされていたから</li><li>ビルドスクリプトの見直し（分割化）</li></ul></section><section class='is-rounded nes-container with-title'><h2 class=title>フラットなコンパイル</h2><p>Tree Shakingがサポートされていたため。<code>--experimental-scope-hoisting</code>で有効にできる。<br>しかも普段使っているrollup.jsと同じ、フラットなコンパイルである。</p><p>というのも、今までのバンドルでは各ファイルのスコープを保つため、それぞれのファイルを<code>function</code>で囲っていた。</p><pre class=language-js><code class=language-js><span class='token comment'>// フラットでないバンドル結果のイメージ</span>\n<span class='token punctuation'>(</span><span class='token keyword'>function</span><span class='token punctuation'>(</span><span class='token punctuation'>)</span><span class='token punctuation'>{</span>\n  <span class='token comment'>// boostrap code</span>\n  <span class='token comment'>// ...</span>\n<span class='token punctuation'>}</span><span class='token punctuation'>)</span><span class='token punctuation'>(</span><span class='token punctuation'>{</span>\n  <span class='token string'>'module.js'</span><span class='token punctuation'>:</span> <span class='token keyword'>function</span> <span class='token punctuation'>(</span><span class='token parameter'><span class='token keyword'>export</span><span class='token punctuation'>,</span> require</span><span class='token punctuation'>)</span> <span class='token punctuation'>{</span>\n    <span class='token keyword'>const</span> <span class='token function function-variable'>add</span> <span class='token operator'>=</span> <span class='token punctuation'>(</span><span class='token parameter'>a<span class='token punctuation'>,</span> b</span><span class='token punctuation'>)</span> <span class='token operator'>=></span> a <span class='token operator'>+</span> b\n\n    <span class='token keyword'>export</span><span class='token punctuation'>.</span>add <span class='token operator'>=</span> add\n  <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n  <span class='token string'>'main.js'</span><span class='token punctuation'>:</span> <span class='token keyword'>function</span> <span class='token punctuation'>(</span><span class='token parameter'><span class='token keyword'>export</span><span class='token punctuation'>,</span> require</span><span class='token punctuation'>)</span> <span class='token punctuation'>{</span>\n    <span class='token keyword'>const</span> add <span class='token operator'>=</span> <span class='token function'>require</span><span class='token punctuation'>(</span><span class='token string'>'module.js'</span><span class='token punctuation'>)</span><span class='token punctuation'>.</span>add\n\n    <span class='token keyword'>const</span> result <span class='token operator'>=</span> <span class='token function'>add</span><span class='token punctuation'>(</span><span class='token number'>1</span><span class='token punctuation'>,</span> <span class='token number'>2</span><span class='token punctuation'>)</span>\n    console<span class='token punctuation'>.</span><span class='token function'>log</span><span class='token punctuation'>(</span>result<span class='token punctuation'>)</span>\n  <span class='token punctuation'>}</span>\n<span class='token punctuation'>}</span><span class='token punctuation'>)</span><span class='token punctuation'>;</span>\n</code></pre><p>それが、こうなる。</p><pre class=language-js><code class=language-js><span class='token comment'>// フラットなバンドル結果のイメージ</span>\n<span class='token punctuation'>(</span><span class='token keyword'>function</span><span class='token punctuation'>(</span><span class='token punctuation'>)</span> <span class='token punctuation'>{</span>\n  <span class='token comment'>// module.js</span>\n  <span class='token keyword'>const</span> <span class='token function function-variable'>add</span> <span class='token operator'>=</span> <span class='token punctuation'>(</span><span class='token parameter'>a<span class='token punctuation'>,</span> b</span><span class='token punctuation'>)</span> <span class='token operator'>=></span> a <span class='token operator'>+</span> b\n  <span class='token comment'>// main.js</span>\n  <span class='token keyword'>const</span> result <span class='token operator'>=</span> <span class='token function'>add</span><span class='token punctuation'>(</span><span class='token number'>1</span><span class='token punctuation'>,</span> <span class='token number'>2</span><span class='token punctuation'>)</span>\n  console<span class='token punctuation'>.</span><span class='token function'>log</span><span class='token punctuation'>(</span>result<span class='token punctuation'>)</span>\n<span class='token punctuation'>}</span><span class='token punctuation'>)</span><span class='token punctuation'>(</span><span class='token punctuation'>)</span><span class='token punctuation'>;</span>\n</code></pre><p>各ファイルのfunctionスコープがなくなり、バンドル結果がコンパクトになっているのがわかる。もしトップレベルの変数名が他ファイルの変数と被っても自動でリネームしてくれる。<br>ただ、オプション名の「experimental」からわかるように実験的なサポートのため、特殊なことを行おうとするとうまくビルドされない可能性がある。前回の記事の<a href=/blog/wasm-bindgen-with-worker/ >WebAssembly</a>ではできなかった。</p></section><section class='is-rounded nes-container with-title'><h2 class=title>ビルドスクリプトの見直し（分割化）</h2><p>変更前では、ビルドスクリプトが1本だったので記事をプレビューする場合でもプログラム全体をコンパイルする必要があった。</p><p>現在は、記事のビルド（ts-node）とプログラムのビルド（parcel）を分離して記事単独でビルドできるようにした。また、watchビルドに対応し、コマンドを叩く必要がなくなった。</p></section><section class='is-rounded nes-container with-title'><h2 class=title>今後</h2><p>rollup.jsでは非対応だったDynamic Importで記事fetchをしてみたい。そうすると、React Suspence使ってみたいからReactに書き換えるかもしれない。</p></section>"},next:{title:"Rust + wasm-bindgen + WebWorkerの環境構築",slug:"wasm-bindgen-with-worker"},sameTags:[{title:"Rust + wasm-bindgen + WebWorkerの環境構築",slug:"wasm-bindgen-with-worker",date:"2018-12-20",tags:["Rust","wasm-bindgen","TypeScript","parcel"]},{title:"ブログをHyperappベースの自作ジェネレータに変更した話",slug:"use-hyperapp",date:"2018-07-12",tags:["blog","Hyperapp"]},{title:"ブログで使用した技術",slug:"use-technology",date:"2018-06-30",tags:["blog","React","preact","TypeScript","ReactStatic"]},{title:"react-strictでブログ作成しました",slug:"first-post",date:"2018-06-29",tags:["blog"]}]}}</script> <script src="/src.9be82b6d.js"></script>
</body></html>