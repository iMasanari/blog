<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>自作ブログのHTMLをminifyした | Tech SANDBOX</title><meta name="description" content="HTMLはホワイトスペースの問題があり、minifyする、しないの意見が別れるようだ。私は普段、HTMLまでは行わないのだが、今回はhtml-minifierを使用してHTMLを圧縮したのでそのメモを残しておく。"/><meta property="og:title" content="自作ブログのHTMLをminifyした"/><meta property="og:description" content="HTMLはホワイトスペースの問題があり、minifyする、しないの意見が別れるようだ。私は普段、HTMLまでは行わないのだが、今回はhtml-minifierを使用してHTMLを圧縮したのでそのメモを残しておく。"/><meta property="og:type" content="article"/><meta property="og:url" content="https://imasanari.github.io/blog/html-minify"/><meta property="og:image" content="https://imasanari.github.io/images/icon.jpg"/><meta property="og:site_name" content="Tech SANDBOX"/><meta name="twitter:card" content="summary"/><meta name="next-head-count" content="11"/><link rel="amphtml" href="/blog/html-minify.amp"/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-61c7970971370c7f4ed5.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.e643c1eae63cf23c9c8b.js" as="script"/><link rel="preload" href="/_next/static/chunks/750b2726a69f361bcb8ab59f8396713b1d057f97.65efe09f4a7cad783b68.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-531c08b83350d7689e7f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-21b7244e95d55cac728f.js" as="script"/><style id="__jsx-2257550242">.SiteTitle.jsx-2257550242{font-size:2rem;margin:1rem 0;}</style><style id="__jsx-2935353441">.Header.jsx-2935353441{padding-top:0;}</style><style id="__jsx-1424798431">.Tags.jsx-1424798431{padding:0;}.item.jsx-1424798431{display:inline;margin:0 0.2em;}.link.jsx-1424798431{color:var(--color-text-secondary);}</style><style id="__jsx-2638938446">.PostPager.jsx-2638938446{display:table;max-width:var(--width-content);margin:2rem auto;}.item.jsx-2638938446{box-sizing:border-box;display:table-cell;width:33.3%;padding:0.5rem;text-align:center;vertical-align:middle;}.home.jsx-2638938446{border-left:1px solid #6c6c6c;border-right:1px solid #6c6c6c;}</style><style id="__jsx-101915585">.Footer.jsx-101915585{text-align:center;}</style><style id="__jsx-910634656">:root{--border-radius:5px;--box-shadow:2px 2px 10px;--color:#118bee;--color-accent:#118bee15;--color-bg:#fff;--color-bg-secondary:#e9e9e9;--color-secondary:#920de9;--color-secondary-accent:#920de90b;--color-shadow:#f4f4f4;--color-text:#000;--color-text-secondary:#999;--font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;--hover-brightness:1.2;--justify-important:center;--justify-normal:left;--line-height:1.5;--width-card:285px;--width-card-medium:460px;--width-card-wide:800px;--width-content:1080px;}article aside{background:var(--color-secondary-accent);border-left:4px solid var(--color-secondary);padding:0.01rem 0.8rem;}body{background:var(--color-bg);color:var(--color-text);font-family:var(--font-family);line-height:var(--line-height);margin:0;overflow-x:hidden;padding:1rem 0;}footer,header,main{margin:0 auto;max-width:var(--width-content);padding:2rem 1rem;}hr{background-color:var(--color-bg-secondary);border:none;height:1px;margin:4rem 0;}section{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:var(--justify-important);-webkit-justify-content:var(--justify-important);-ms-flex-pack:var(--justify-important);justify-content:var(--justify-important);}section aside{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);margin:1rem;padding:1.25rem;width:var(--width-card);}section aside:hover{box-shadow:var(--box-shadow) var(--color-bg-secondary);}section aside img{max-width:100%;}[hidden]{display:none;}article header,div header,main header{padding-top:0;}header{text-align:var(--justify-important);}header a b,header a em,header a i,header a strong{margin-left:0.5rem;margin-right:0.5rem;}header nav img{margin:1rem 0;}section header{padding-top:0;width:100%;}nav{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-weight:bold;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:7rem;}nav ul{list-style:none;padding:0;}nav ul li{display:inline-block;margin:0 0.5rem;position:relative;text-align:left;}nav ul li:hover ul{display:block;}nav ul li ul{background:var(--color-bg);border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:none;height:auto;left:-2px;padding:.5rem 1rem;position:absolute;top:1.7rem;white-space:nowrap;width:auto;}nav ul li ul li,nav ul li ul li a{display:block;}code,samp{background-color:var(--color-accent);border-radius:var(--border-radius);color:var(--color-text);display:inline-block;margin:0 0.1rem;padding:0 0.5rem;}details{margin:1.3rem 0;}details summary{font-weight:bold;cursor:pointer;}h1,h2,h3,h4,h5,h6{line-height:var(--line-height);}mark{padding:0.1rem;}ol li,ul li{padding:0.2rem 0;}p{margin:0.75rem 0;padding:0;}pre{margin:1rem 0;max-width:var(--width-card-wide);padding:1rem 0;}pre code,pre samp{display:block;max-width:var(--width-card-wide);padding:0.5rem 2rem;white-space:pre-wrap;}small{color:var(--color-text-secondary);}sup{background-color:var(--color-secondary);border-radius:var(--border-radius);color:var(--color-bg);font-size:xx-small;font-weight:bold;margin:0.2rem;padding:0.2rem 0.3rem;position:relative;top:-2px;}a{color:var(--color-secondary);display:inline-block;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-filter:brightness(var(--hover-brightness));filter:brightness(var(--hover-brightness));-webkit-text-decoration:underline;text-decoration:underline;}a b,a em,a i,a strong,button{border-radius:var(--border-radius);display:inline-block;font-size:medium;font-weight:bold;line-height:var(--line-height);margin:0.5rem 0;padding:1rem 2rem;}button{font-family:var(--font-family);}button:hover{cursor:pointer;-webkit-filter:brightness(var(--hover-brightness));filter:brightness(var(--hover-brightness));}a b,a strong,button{background-color:var(--color);border:2px solid var(--color);color:var(--color-bg);}a em,a i{border:2px solid var(--color);border-radius:var(--border-radius);color:var(--color);display:inline-block;padding:1rem 2rem;}figure{margin:0;padding:0;}figure img{max-width:100%;}figure figcaption{color:var(--color-text-secondary);}button:disabled,input:disabled{background:var(--color-bg-secondary);border-color:var(--color-bg-secondary);color:var(--color-text-secondary);cursor:not-allowed;}button[disabled]:hover{-webkit-filter:none;filter:none;}form{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);box-shadow:var(--box-shadow) var(--color-shadow);display:block;max-width:var(--width-card-wide);min-width:var(--width-card);padding:1.5rem;text-align:var(--justify-normal);}form header{margin:1.5rem 0;padding:1.5rem 0;}input,label,select,textarea{display:block;font-size:inherit;max-width:var(--width-card-wide);}input[type="checkbox"],input[type="radio"]{display:inline-block;}input[type="checkbox"]+label,input[type="radio"]+label{display:inline-block;font-weight:normal;position:relative;top:1px;}input,select,textarea{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);margin-bottom:1rem;padding:0.4rem 0.8rem;}input[readonly],textarea[readonly]{background-color:var(--color-bg-secondary);}label{font-weight:bold;margin-bottom:0.2rem;}table{border:1px solid var(--color-bg-secondary);border-radius:var(--border-radius);border-spacing:0;display:inline-block;max-width:100%;overflow-x:auto;padding:0;white-space:nowrap;}table td,table th,table tr{padding:0.4rem 0.8rem;text-align:var(--justify-important);}table thead{background-color:var(--color);border-collapse:collapse;border-radius:var(--border-radius);color:var(--color-bg);margin:0;padding:0;}table thead th:first-child{border-top-left-radius:var(--border-radius);}table thead th:last-child{border-top-right-radius:var(--border-radius);}table thead th:first-child,table tr td:first-child{text-align:var(--justify-normal);}table tr:nth-child(even){background-color:var(--color-accent);}blockquote{display:block;font-size:x-large;line-height:var(--line-height);margin:1rem auto;max-width:var(--width-card-medium);padding:1.5rem 1rem;text-align:var(--justify-important);}blockquote footer{color:var(--color-text-secondary);display:block;font-size:small;line-height:var(--line-height);padding:1.5rem 0;}code[class*="language-"],pre[class*="language-"]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,0.3);font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}pre[class*="language-"]{padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;}:not(pre)>code[class*="language-"],pre[class*="language-"]{background:#272822;}:not(pre)>code[class*="language-"]{padding:.1em;border-radius:.3em;white-space:normal;}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#8292a2;}.token.punctuation{color:#f8f8f2;}.token.namespace{opacity:.7;}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672;}.token.boolean,.token.number{color:#ae81ff;}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e;}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2;}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74;}.token.keyword{color:#66d9ef;}.token.regex,.token.important{color:#fd971f;}.token.important,.token.bold{font-weight:bold;}.token.italic{font-style:italic;}.token.entity{cursor:help;}main{display:block;}header+main{padding-top:0;}header:last-child{padding-bottom:0;}pre{overflow:auto;max-width:none;padding:0.5rem 2rem;background:#272822;}pre code,pre samp{display:inline;padding:0;}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string{background:transparent;}@media (prefers-color-scheme:dark){:root{--color:#0097fc;--color-accent:#0097fc4f;--color-bg:#333;--color-bg-secondary:#555;--color-secondary:#e20de9;--color-secondary-accent:#e20de94f;--color-shadow:#bbbbbb20;--color-text:#f7f7f7;--color-text-secondary:#aaa;}}</style></head><body><div id="__next"><header class="jsx-2935353441 Header"><div class="jsx-2257550242 SiteTitle"><a class="jsx-2257550242" href="/">Tech SANDBOX</a></div><p class="jsx-2935353441">技術ブログ改め、Qiitaの下書き</p></header><div><article><header><time dateTime="2018-07-29T14:19:54.882Z">2018-07-29</time><h1>自作ブログのHTMLをminifyした</h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/html-minifier/">#<!-- -->html-minifier</a></li></ul></header><main><div><h2 id="はじめに">はじめに</h2><p>HTMLはホワイトスペースの問題があり、minifyする、しないの意見が別れるようだ。私は普段、HTMLまでは行わないのだが、今回は<a href="https://github.com/kangax/html-minifier">html-minifier</a>を使用してHTMLを圧縮したのでそのメモを残しておく。</p><h2 id="動機">動機</h2><ul><li>markdownの変換するHTMLが気に入らない<ul><li>改行はあるがインデントはなく、整形が中途半端</li><li>minifyして綺麗にしよう！</li></ul></li><li>軽量化<ul><li>Hyperappにしたので、軽さにはこだわりたい</li></ul></li></ul><h2 id="設定">設定</h2><p>このブログのHTMLは、Hyperappで生成される部分とmarkdownで生成される部分の2つがある。今回はそれぞれ別の設定でminifyを行った。</p><h3 id="hyperapp--html">Hyperapp / HTML</h3><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token punctuation">{</span>
  minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  sortAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  sortClassName<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>この設定は、Hyperappが事前レンダリングで生成したHTMLに対して行うものである。Virtual DOMから生成されるHTMLには不必要な空白はなく、また実際のDOMとズレているとエラーになりうるので破壊的な変更は行っていない。なので、プロダクションビルド時にのみ行っている。</p><p><code>minifyJS</code>は埋め込まれたHyperappの初期state用の設定だ。JSON形式で埋め込まれるため、その余分なクォートを取り除いている。</p><pre><code class="language-diff" data-language="diff" data-highlighted-line-numbers=""><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">var __data = {"foo": "bar"}
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">var __data = {foo: "bar"}
</span></span></code></pre><h3 id="markdown--json">markdown / JSON</h3><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token punctuation">{</span>
  collapseBooleanAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// collapseInlineTagWhitespace: true,</span>
  collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  quoteCharacter<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  removeAttributeQuotes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  removeRedundantAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  sortAttributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  sortClassName<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>markdownは、ホワイトスペースの削除など破壊的になりうる設定を取り入れている。これは、Hyperappの<code>innerHTML</code>で入れているためVirtual DOMの管理外であるからだ。こちらは、破壊箇所がないか様子を見るためにプロダクションビルドでない時にもminifyを行っている。（そのうちプロダクションビルド時のみにしたい）</p><p>最初は、細かい作り込みができないmarkdownでは<code>collapseInlineTagWhitespace</code>の影響を受けることはないだろうと有効にしていた。しかし、<code>**foo** **bar**</code>と書いた時に間のスペースが消えることに気づき、またその設定で効果が出るHTMLをmarkdownが生成するとは思えないのでオフにした。</p><p>また、このHTMLはJSONの中にも埋め込まれることから、シングルクォート使用するよう設定した。</p><h2 id="採用を断念した設定">採用を断念した設定</h2><p>markdownで<code>removeOptionalTags</code>というオプションを使用したかったのだが今回の用法では見送った。これは、省略可能なタグを削除するもので、<code>p</code>や<code>li</code>の終了タグがその対象の1つだ。</p><p>今回の用法では、markdown時、Hyperapp時と2重にminifyされる。1回目の時に<code>removeOptionalTags</code>を有効にすると、2回目の時にHTMLが正しくパースされなかった。</p><pre><code class="language-markup" data-language="markup" data-highlighted-line-numbers=""><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>終了タグは省略
<span class="token comment">&lt;!-- 終了タグの正しい場所 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span>/* 別のタグ */<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- html-minifierが&lt;/p>を挿入した場所 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>別のpタグ
</code></pre><p>2回目の時にもそのオプションが有効なら間違えて挿入した終了タグも削除された。だが、間違えた状態でminifyされるコードを信頼できないため、<code>removeOptionalTags</code>は行わないことにした。</p><h2 id="結果">結果</h2><p>1つ前の記事<a href="/blog/remove-object-key/">【ES.next】Objectから任意のキーを削除した新しいObjectを作成する</a>をminifyした。</p><table><thead><tr><th align="left">設定</th><th align="right">HTML</th><th align="right">JSON</th></tr></thead><tbody><tr><td align="left">HTML minifyなし</td><td align="right">14,170 Byte</td><td align="right">6,275 Byte</td></tr><tr><td align="left"><code>removeOptionalTags</code>なし</td><td align="right">13,872 Byte</td><td align="right">6,088 Byte</td></tr><tr><td align="left"><code>removeOptionalTags</code>あり</td><td align="right">13,722 Byte</td><td align="right">6,037 Byte</td></tr></tbody></table><p><code>removeOptionalTags</code>をありにしても元のHTMLの96.8%程度。インデントなしのHTMLをminifyしてもあまり効果はないようだ。
また、<code>removeOptionalTags</code>の有無もあまり差はなかった。箇条書きを多用すればもう少し差が開く可能性はあるが、わざわざ有効にするほどでもなさそう。</p></div></main></article><div class="jsx-2638938446 PostPager"><div class="jsx-2638938446 item"><a class="jsx-2638938446" href="/blog/remove-object-key/">【ES.next】Objectから任意のキーを削除した新しいObjectを作成する</a></div><div class="jsx-2638938446 item home"><a class="jsx-2638938446" href="/">HOME</a></div><div class="jsx-2638938446 item"><a class="jsx-2638938446" href="/blog/environment-construction/">私の必要最低限な環境構築</a></div></div></div><footer class="jsx-101915585 Footer"><p class="jsx-101915585">Author: <a href="https://github.com/iMasanari" class="jsx-101915585">iMasanari</a></p><small class="jsx-101915585"><a href="https://github.com/iMasanari/imasanari.github.io/" class="jsx-101915585">Show on GitHub</a></small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"自作ブログのHTMLをminifyした","description":"HTMLはホワイトスペースの問題があり、minifyする、しないの意見が別れるようだ。私は普段、HTMLまでは行わないのだが、今回はhtml-minifierを使用してHTMLを圧縮したのでそのメモを残しておく。","slug":"html-minify","tags":["html-minifier"],"image":"/images/html-minify.png","date":"2018-07-29T14:19:54.882Z","body":"\u003ch2 id=\"はじめに\"\u003eはじめに\u003c/h2\u003e\u003cp\u003eHTMLはホワイトスペースの問題があり、minifyする、しないの意見が別れるようだ。私は普段、HTMLまでは行わないのだが、今回は\u003ca href=\"https://github.com/kangax/html-minifier\"\u003ehtml-minifier\u003c/a\u003eを使用してHTMLを圧縮したのでそのメモを残しておく。\u003c/p\u003e\u003ch2 id=\"動機\"\u003e動機\u003c/h2\u003e\u003cul\u003e\u003cli\u003emarkdownの変換するHTMLが気に入らない\u003cul\u003e\u003cli\u003e改行はあるがインデントはなく、整形が中途半端\u003c/li\u003e\u003cli\u003eminifyして綺麗にしよう！\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003e軽量化\u003cul\u003e\u003cli\u003eHyperappにしたので、軽さにはこだわりたい\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"設定\"\u003e設定\u003c/h2\u003e\u003cp\u003eこのブログのHTMLは、Hyperappで生成される部分とmarkdownで生成される部分の2つがある。今回はそれぞれ別の設定でminifyを行った。\u003c/p\u003e\u003ch3 id=\"hyperapp--html\"\u003eHyperapp / HTML\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"language-jsx\" data-language=\"jsx\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  minifyCSS\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  minifyJS\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  removeAttributeQuotes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  sortAttributes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  sortClassName\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eこの設定は、Hyperappが事前レンダリングで生成したHTMLに対して行うものである。Virtual DOMから生成されるHTMLには不必要な空白はなく、また実際のDOMとズレているとエラーになりうるので破壊的な変更は行っていない。なので、プロダクションビルド時にのみ行っている。\u003c/p\u003e\u003cp\u003e\u003ccode\u003eminifyJS\u003c/code\u003eは埋め込まれたHyperappの初期state用の設定だ。JSON形式で埋め込まれるため、その余分なクォートを取り除いている。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-diff\" data-language=\"diff\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token deleted-sign deleted\"\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003evar __data = {\"foo\": \"bar\"}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003evar __data = {foo: \"bar\"}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"markdown--json\"\u003emarkdown / JSON\u003c/h3\u003e\u003cpre\u003e\u003ccode class=\"language-jsx\" data-language=\"jsx\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  collapseBooleanAttributes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// collapseInlineTagWhitespace: true,\u003c/span\u003e\n  collapseWhitespace\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  quoteCharacter\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token template-string\"\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003cspan class=\"token string\"\u003e'\u003c/span\u003e\u003cspan class=\"token template-punctuation string\"\u003e`\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  removeAttributeQuotes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  removeRedundantAttributes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  sortAttributes\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  sortClassName\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003emarkdownは、ホワイトスペースの削除など破壊的になりうる設定を取り入れている。これは、Hyperappの\u003ccode\u003einnerHTML\u003c/code\u003eで入れているためVirtual DOMの管理外であるからだ。こちらは、破壊箇所がないか様子を見るためにプロダクションビルドでない時にもminifyを行っている。（そのうちプロダクションビルド時のみにしたい）\u003c/p\u003e\u003cp\u003e最初は、細かい作り込みができないmarkdownでは\u003ccode\u003ecollapseInlineTagWhitespace\u003c/code\u003eの影響を受けることはないだろうと有効にしていた。しかし、\u003ccode\u003e**foo** **bar**\u003c/code\u003eと書いた時に間のスペースが消えることに気づき、またその設定で効果が出るHTMLをmarkdownが生成するとは思えないのでオフにした。\u003c/p\u003e\u003cp\u003eまた、このHTMLはJSONの中にも埋め込まれることから、シングルクォート使用するよう設定した。\u003c/p\u003e\u003ch2 id=\"採用を断念した設定\"\u003e採用を断念した設定\u003c/h2\u003e\u003cp\u003emarkdownで\u003ccode\u003eremoveOptionalTags\u003c/code\u003eというオプションを使用したかったのだが今回の用法では見送った。これは、省略可能なタグを削除するもので、\u003ccode\u003ep\u003c/code\u003eや\u003ccode\u003eli\u003c/code\u003eの終了タグがその対象の1つだ。\u003c/p\u003e\u003cp\u003e今回の用法では、markdown時、Hyperapp時と2重にminifyされる。1回目の時に\u003ccode\u003eremoveOptionalTags\u003c/code\u003eを有効にすると、2回目の時にHTMLが正しくパースされなかった。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-markup\" data-language=\"markup\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e終了タグは省略\n\u003cspan class=\"token comment\"\u003e\u0026lt;!-- 終了タグの正しい場所 --\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003epre\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ecode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e/* 別のタグ */\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003ecode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;/\u003c/span\u003epre\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e\u0026lt;!-- html-minifierが\u0026lt;/p\u003eを挿入した場所 --\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026lt;\u003c/span\u003ep\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e別のpタグ\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e2回目の時にもそのオプションが有効なら間違えて挿入した終了タグも削除された。だが、間違えた状態でminifyされるコードを信頼できないため、\u003ccode\u003eremoveOptionalTags\u003c/code\u003eは行わないことにした。\u003c/p\u003e\u003ch2 id=\"結果\"\u003e結果\u003c/h2\u003e\u003cp\u003e1つ前の記事\u003ca href=\"/blog/remove-object-key/\"\u003e【ES.next】Objectから任意のキーを削除した新しいObjectを作成する\u003c/a\u003eをminifyした。\u003c/p\u003e\u003ctable\u003e\u003cthead\u003e\u003ctr\u003e\u003cth align=\"left\"\u003e設定\u003c/th\u003e\u003cth align=\"right\"\u003eHTML\u003c/th\u003e\u003cth align=\"right\"\u003eJSON\u003c/th\u003e\u003c/tr\u003e\u003c/thead\u003e\u003ctbody\u003e\u003ctr\u003e\u003ctd align=\"left\"\u003eHTML minifyなし\u003c/td\u003e\u003ctd align=\"right\"\u003e14,170 Byte\u003c/td\u003e\u003ctd align=\"right\"\u003e6,275 Byte\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd align=\"left\"\u003e\u003ccode\u003eremoveOptionalTags\u003c/code\u003eなし\u003c/td\u003e\u003ctd align=\"right\"\u003e13,872 Byte\u003c/td\u003e\u003ctd align=\"right\"\u003e6,088 Byte\u003c/td\u003e\u003c/tr\u003e\u003ctr\u003e\u003ctd align=\"left\"\u003e\u003ccode\u003eremoveOptionalTags\u003c/code\u003eあり\u003c/td\u003e\u003ctd align=\"right\"\u003e13,722 Byte\u003c/td\u003e\u003ctd align=\"right\"\u003e6,037 Byte\u003c/td\u003e\u003c/tr\u003e\u003c/tbody\u003e\u003c/table\u003e\u003cp\u003e\u003ccode\u003eremoveOptionalTags\u003c/code\u003eをありにしても元のHTMLの96.8%程度。インデントなしのHTMLをminifyしてもあまり効果はないようだ。\nまた、\u003ccode\u003eremoveOptionalTags\u003c/code\u003eの有無もあまり差はなかった。箇条書きを多用すればもう少し差が開く可能性はあるが、わざわざ有効にするほどでもなさそう。\u003c/p\u003e"},"next":{"title":"私の必要最低限な環境構築","description":"macOS Mojaveのダークモードに憧れ、Macbookのサブパーテーションにパブリックベータをインストールした。メインのパーテーションに入れるかを検討するため、しばらくはこちらを使用していこうと思う。このパーテーションはHigh Sierraのパブリックベータからのアップデートのため新規インストールではないが、一通り開発できる環境を整え、それをまとめることにする。","slug":"environment-construction","tags":["macOS"],"date":"2018-08-09T15:46:41.052Z","update":"2018-08-31T23:55:19.826Z"},"prev":{"title":"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する","description":"ブログを作る前、Qiitaに投稿しようと書いていたけど途中でやめ、最近まで忘れていた記事です。Qiitaでもいいけど、せっかくだからこっちに置いておきます。","slug":"remove-object-key","tags":["JavaScript","Babel","TypeScript"],"date":"2018-07-13T12:47:36.148Z"},"sameTags":[]},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"html-minify"},"buildId":"YGB0w7B2ZohE0D0hJizmv","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-83732ebf2ed7f8a1b2c7.js"></script><script src="/_next/static/chunks/main-61c7970971370c7f4ed5.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.e643c1eae63cf23c9c8b.js" async=""></script><script src="/_next/static/chunks/750b2726a69f361bcb8ab59f8396713b1d057f97.65efe09f4a7cad783b68.js" async=""></script><script src="/_next/static/chunks/pages/_app-531c08b83350d7689e7f.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-21b7244e95d55cac728f.js" async=""></script><script src="/_next/static/YGB0w7B2ZohE0D0hJizmv/_buildManifest.js" async=""></script><script src="/_next/static/YGB0w7B2ZohE0D0hJizmv/_ssgManifest.js" async=""></script></body></html>