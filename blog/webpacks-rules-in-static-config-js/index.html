<!DOCTYPE html><html lang="ja-JP"><head><title data-react-helmet="true">React StaticでTypeScriptを使用した時のエラー対処法 - Tech SANDBOX</title><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:title" content="React StaticでTypeScriptを使用した時のエラー対処法 - Tech SANDBOX"/><meta data-react-helmet="true" property="og:description" content="static.config.jsのwebpack設定を変更することで起こるエラーの対処法。"/><meta data-react-helmet="true" property="og:url" content="https://imasanari.github.io/blogwebpacks-rules-in-static-config-js"/><meta data-react-helmet="true" property="og:image" content="https://imasanari.github.io/images/icon.jpg"/><link rel="preload" as="script" href="/bootstrap.8cc3f30e.js"/><link rel="preload" as="script" href="/templates/src/containers/Post.ef1bb03d.js"/><link rel="preload" as="script" href="/main.322c520c.js"/><link rel="preload" as="style" href="/styles.e6dfbb50.css"/><link rel="stylesheet" href="/styles.e6dfbb50.css"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body><div id="root"><div class="App" data-reactroot=""><header class="Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="content"><article><span>2018-07-03</span><h1>React StaticでTypeScriptを使用した時のエラー対処法</h1><ul class="PostTags"><li class="PostTags-li"><a class="PostTags-Link" href="/tags/ReactStatic">ReactStatic</a> </li><li class="PostTags-li"><a class="PostTags-Link" href="/tags/TypeScript">TypeScript</a> </li><li class="PostTags-li"><a class="PostTags-Link" href="/tags/webpack">webpack</a> </li></ul><div><h2>rulesを変更して<code>npm run build</code>するとエラーに</h2>
<p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中(<code>npm run start</code>)では問題はないが、プロダクションビルド(<code>npm run build</code>)するとエラーになるのでその対処法をメモして置く。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run build
<span class="token comment"># ...</span>
Error: Module build failed: Error: <span class="token string">"extract-text-webpack-plugin"</span> loader is used 
without the  corresponding plugin, refer to 
https://github.com/webpack/extract-text-webpack-plugin <span class="token keyword">for</span> th  e usage example
</code></pre><p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// static.config.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  webpack<span class="token punctuation">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultLoaders <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      oneOf<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>
        defaultLoaders<span class="token punctuation">.</span>jsLoader<span class="token punctuation">,</span>
        defaultLoaders<span class="token punctuation">.</span>cssLoader<span class="token punctuation">,</span>
        defaultLoaders<span class="token punctuation">.</span>fileLoader<span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>デフォルトとは一体…</p>
<p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p>
<h2>暫定的対処法</h2>
<p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// static.config.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  webpack<span class="token punctuation">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultLoaders <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">)</span>

    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(js|jsx|ts|tsx)$/</span><span class="token punctuation">,</span>
      exclude<span class="token punctuation">:</span> defaultLoaders<span class="token punctuation">.</span>jsLoader<span class="token punctuation">.</span>exclude<span class="token punctuation">,</span> <span class="token comment">// as std jsLoader exclude</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ts-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span> transpileOnly<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>
</div></article><div class="PostPager"><div class="PostPager-item"></div><div class="PostPager-item"><a class="active" aria-current="page" href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/deploy-to-github-pages-user-page">GitHub PagesのUser Pageにdistフォルダをデプロイする</a></div></div></div><footer class="Footer"><p>Author: <a href="https://github.com/iMasanari">iMasanari</a></p><small><a href="https://github.com/iMasanari/imasanari.github.io/">&gt; Blog Repository &lt;</a></small></footer></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"/styles.e6dfbb50.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"blog/webpacks-rules-in-static-config-js","templateID":2,"sharedPropsHashes":{},"localProps":null,"allProps":{"post":{"title":"React StaticでTypeScriptを使用した時のエラー対処法","description":"static.config.jsのwebpack設定を変更することで起こるエラーの対処法。","slug":"webpacks-rules-in-static-config-js","tags":["ReactStatic","TypeScript","webpack"],"date":"2018-07-03","contents":"<h2>rulesを変更して<code>npm run build</code>するとエラーに</h2>\n<p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中(<code>npm run start</code>)では問題はないが、プロダクションビルド(<code>npm run build</code>)するとエラーになるのでその対処法をメモして置く。</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> run build\n<span class=\"token comment\"># ...</span>\nError: Module build failed: Error: <span class=\"token string\">\"extract-text-webpack-plugin\"</span> loader is used \nwithout the  corresponding plugin, refer to \nhttps://github.com/webpack/extract-text-webpack-plugin <span class=\"token keyword\">for</span> th  e usage example\n</code></pre><p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// static.config.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  webpack<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> defaultLoaders <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      oneOf<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>jsLoader<span class=\"token punctuation\">,</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>cssLoader<span class=\"token punctuation\">,</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>fileLoader<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><p>デフォルトとは一体…</p>\n<p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p>\n<h2>暫定的対処法</h2>\n<p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// static.config.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  webpack<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> defaultLoaders <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">)</span>\n\n    config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>oneOf<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.(js|jsx|ts|tsx)$/</span><span class=\"token punctuation\">,</span>\n      exclude<span class=\"token punctuation\">:</span> defaultLoaders<span class=\"token punctuation\">.</span>jsLoader<span class=\"token punctuation\">.</span>exclude<span class=\"token punctuation\">,</span> <span class=\"token comment\">// as std jsLoader exclude</span>\n      use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ts-loader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          options<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> transpileOnly<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>\n"},"next":{"title":"GitHub PagesのUser Pageにdistフォルダをデプロイする","slug":"deploy-to-github-pages-user-page"}},"siteData":{}};</script><script defer="" type="text/javascript" src="/bootstrap.8cc3f30e.js"></script><script defer="" type="text/javascript" src="/templates/src/containers/Post.ef1bb03d.js"></script><script defer="" type="text/javascript" src="/main.322c520c.js"></script></body></html>