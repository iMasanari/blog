<!DOCTYPE html><html lang="ja-JP" prefix="og: http://ogp.me/ns#"><head><script src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74494516-4")</script><link href="/bundle.f534e47a35.js" rel="preload" as="script"><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><title>React StaticでTypeScriptを使用した時のエラー対処法 - Tech SANDBOX</title><style>
  body{font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-weight:300;font-size:16px;margin:0;padding:0}a{text-decoration:none;color:#108db8;font-weight:700}h2{border-bottom:1px solid #6c6c6c;border-right:1px solid #6c6c6c;padding-left:.5em}.App{display:flex;flex-direction:column;min-height:100vh}.content{flex:1;box-sizing:border-box;width:100%;max-width:700px;padding:0 1rem;margin:2rem auto}.Header{background:#108db8;box-shadow:0 5px 15px -5px rgba(0,0,0,.8)}.Header-title{margin:0;padding:1rem;text-align:center}.Header-title a{color:#fff}.PostTags{padding:0;margin:0}.PostTags:before{content:"tags: "}.PostTags-li{display:inline;padding:0}.PostTags-Link{color:#6c6c6c}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}pre[class*=language-]{background:#f5f2f0}.token.comment{color:#708090}.token.punctuation{color:#999}.token.string{color:#690}.token.operator{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.keyword{color:#07a}.token.function{color:#dd4a68}
</style>
<link href="/bundle.f534e47a35.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="/bundle.f534e47a35.css" rel="stylesheet"></noscript>
<script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script><meta content="static.config.jsのwebpack設定を変更することで起こるエラーの対処法。" name="description"><meta content="React StaticでTypeScriptを使用した時のエラー対処法 - Tech SANDBOX" property="og:title"><meta content="article" property="og:type"><meta content="static.config.jsのwebpack設定を変更することで起こるエラーの対処法。" property="og:description"><meta content="https://imasanari.github.io/blog/webpacks-rules-in-static-config-js/" property="og:url"><meta content="https://imasanari.github.io/images/icon.jpg" property="og:image"><meta content="summary" name="twitter:card"></head><body><div class="App"><header class="Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="content"><div><article><span>2018-07-03</span><h1>React StaticでTypeScriptを使用した時のエラー対処法</h1><ul class="PostTags"><li class="PostTags-li"><a href="/tags/ReactStatic/" class="PostTags-Link">ReactStatic</a> </li><li class="PostTags-li"><a href="/tags/TypeScript/" class="PostTags-Link">TypeScript</a> </li><li class="PostTags-li"><a href="/tags/webpack/" class="PostTags-Link">webpack</a> </li></ul><div><h2>rulesを変更して<code>npm run build</code>するとエラーに</h2><p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中（<code>npm run start</code>）では問題はないが、プロダクションビルド（<code>npm run build</code>）するとエラーになるのでその対処法をメモして置く。</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run build
<span class="token comment"># ...</span>
Error: Module build failed: Error: <span class="token string">"extract-text-webpack-plugin"</span> loader is used 
without the  corresponding plugin, refer to 
https://github.com/webpack/extract-text-webpack-plugin <span class="token keyword">for</span> th  e usage example
</code></pre><p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p><pre class="language-js"><code class="language-js"><span class="token comment">// static.config.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  webpack<span class="token punctuation">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultLoaders <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      oneOf<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>
        defaultLoaders<span class="token punctuation">.</span>jsLoader<span class="token punctuation">,</span>
        defaultLoaders<span class="token punctuation">.</span>cssLoader<span class="token punctuation">,</span>
        defaultLoaders<span class="token punctuation">.</span>fileLoader<span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>デフォルトとは一体…</p><p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p><h2>暫定的対処法</h2><p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p><pre class="language-js"><code class="language-js"><span class="token comment">// static.config.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  webpack<span class="token punctuation">:</span> <span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultLoaders <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">)</span>

    config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token regex">/\.(js|jsx|ts|tsx)$/</span><span class="token punctuation">,</span>
      exclude<span class="token punctuation">:</span> defaultLoaders<span class="token punctuation">.</span>jsLoader<span class="token punctuation">.</span>exclude<span class="token punctuation">,</span> <span class="token comment">// as std jsLoader exclude</span>
      use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ts-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span> transpileOnly<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p></div></article><div class="PostPager"><div class="PostPager-item"><a href="/blog/use-hyperapp/">【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話</a></div><div class="PostPager-item"><a href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/deploy-to-github-pages-user-page/">GitHub PagesのUser Pageにdistフォルダをデプロイする</a></div></div></div></div><footer class="Footer"><p>Author: <a href="https://github.com/iMasanari">iMasanari</a></p><small><a href="https://github.com/iMasanari/imasanari.github.io/">&gt; Blog Repository &lt;</a></small></footer></div><script>var __data={component:1,title:"React StaticでTypeScriptを使用した時のエラー対処法 - Tech SANDBOX",props:{post:{title:"React StaticでTypeScriptを使用した時のエラー対処法",description:"static.config.jsのwebpack設定を変更することで起こるエラーの対処法。",slug:"webpacks-rules-in-static-config-js",tags:["ReactStatic","TypeScript","webpack"],date:"2018-07-03",contents:"<h2>rulesを変更して<code>npm run build</code>するとエラーに</h2><p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中（<code>npm run start</code>）では問題はないが、プロダクションビルド（<code>npm run build</code>）するとエラーになるのでその対処法をメモして置く。</p><pre class=language-bash><code class=language-bash>$ <span class='token function'>npm</span> run build\n<span class='token comment'># ...</span>\nError: Module build failed: Error: <span class='token string'>\"extract-text-webpack-plugin\"</span> loader is used \nwithout the  corresponding plugin, refer to \nhttps://github.com/webpack/extract-text-webpack-plugin <span class='token keyword'>for</span> th  e usage example\n</code></pre><p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p><pre class=language-js><code class=language-js><span class='token comment'>// static.config.js</span>\n\n<span class='token keyword'>export</span> <span class='token keyword'>default</span> <span class='token punctuation'>{</span>\n  <span class='token comment'>// ...</span>\n  webpack<span class='token punctuation'>:</span> <span class='token punctuation'>(</span>config<span class='token punctuation'>,</span> <span class='token punctuation'>{</span> defaultLoaders <span class='token punctuation'>}</span><span class='token punctuation'>)</span> <span class='token operator'>=></span> <span class='token punctuation'>{</span>\n    config<span class='token punctuation'>.</span>module<span class='token punctuation'>.</span>rules <span class='token operator'>=</span> <span class='token punctuation'>[</span><span class='token punctuation'>{</span>\n      oneOf<span class='token punctuation'>:</span> <span class='token punctuation'>[</span>\n        <span class='token comment'>// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>\n        defaultLoaders<span class='token punctuation'>.</span>jsLoader<span class='token punctuation'>,</span>\n        defaultLoaders<span class='token punctuation'>.</span>cssLoader<span class='token punctuation'>,</span>\n        defaultLoaders<span class='token punctuation'>.</span>fileLoader<span class='token punctuation'>,</span>\n      <span class='token punctuation'>]</span><span class='token punctuation'>,</span>\n    <span class='token punctuation'>}</span><span class='token punctuation'>]</span>\n\n    <span class='token keyword'>return</span> config\n  <span class='token punctuation'>}</span>\n<span class='token punctuation'>}</span>\n</code></pre><p>デフォルトとは一体…</p><p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p><h2>暫定的対処法</h2><p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p><pre class=language-js><code class=language-js><span class='token comment'>// static.config.js</span>\n\n<span class='token keyword'>export</span> <span class='token keyword'>default</span> <span class='token punctuation'>{</span>\n  <span class='token comment'>// ...</span>\n  webpack<span class='token punctuation'>:</span> <span class='token punctuation'>(</span>config<span class='token punctuation'>,</span> <span class='token punctuation'>{</span> defaultLoaders <span class='token punctuation'>}</span><span class='token punctuation'>)</span> <span class='token operator'>=></span> <span class='token punctuation'>{</span>\n    config<span class='token punctuation'>.</span>resolve<span class='token punctuation'>.</span>extensions<span class='token punctuation'>.</span><span class='token function'>push</span><span class='token punctuation'>(</span><span class='token string'>'.ts'</span><span class='token punctuation'>,</span> <span class='token string'>'.tsx'</span><span class='token punctuation'>)</span>\n\n    config<span class='token punctuation'>.</span>module<span class='token punctuation'>.</span>rules<span class='token punctuation'>[</span><span class='token number'>0</span><span class='token punctuation'>]</span><span class='token punctuation'>.</span>oneOf<span class='token punctuation'>.</span><span class='token function'>unshift</span><span class='token punctuation'>(</span><span class='token punctuation'>{</span>\n      test<span class='token punctuation'>:</span> <span class='token regex'>/\\.(js|jsx|ts|tsx)$/</span><span class='token punctuation'>,</span>\n      exclude<span class='token punctuation'>:</span> defaultLoaders<span class='token punctuation'>.</span>jsLoader<span class='token punctuation'>.</span>exclude<span class='token punctuation'>,</span> <span class='token comment'>// as std jsLoader exclude</span>\n      use<span class='token punctuation'>:</span> <span class='token punctuation'>[</span>\n        <span class='token punctuation'>{</span> loader<span class='token punctuation'>:</span> <span class='token string'>'babel-loader'</span> <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n        <span class='token punctuation'>{</span>\n          loader<span class='token punctuation'>:</span> require<span class='token punctuation'>.</span><span class='token function'>resolve</span><span class='token punctuation'>(</span><span class='token string'>'ts-loader'</span><span class='token punctuation'>)</span><span class='token punctuation'>,</span>\n          options<span class='token punctuation'>:</span> <span class='token punctuation'>{</span> transpileOnly<span class='token punctuation'>:</span> <span class='token boolean'>true</span> <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n        <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n      <span class='token punctuation'>]</span><span class='token punctuation'>,</span>\n    <span class='token punctuation'>}</span><span class='token punctuation'>)</span>\n\n    <span class='token keyword'>return</span> config\n  <span class='token punctuation'>}</span><span class='token punctuation'>,</span>\n<span class='token punctuation'>}</span>\n</code></pre><p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>"},prev:{title:"【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話",slug:"use-hyperapp"},next:{title:"GitHub PagesのUser Pageにdistフォルダをデプロイする",slug:"deploy-to-github-pages-user-page"}}}</script><script src="/bundle.f534e47a35.js"></script></body></html>