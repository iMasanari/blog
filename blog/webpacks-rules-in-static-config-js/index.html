<!DOCTYPE html><html lang="ja-JP"><head><title data-react-helmet="true">static.config.jsでwebpackのrulesを変更した時のエラーの対処法 - Tech SANDBOX</title><link rel="preload" as="script" href="/bootstrap.920b863d.js"/><link rel="preload" as="script" href="/templates/src/containers/Post.e0cce4a8.js"/><link rel="preload" as="script" href="/main.1a0e896c.js"/><link rel="preload" as="style" href="/styles.37921a17.css"/><link rel="stylesheet" href="/styles.37921a17.css"/><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/></head><body><div id="root"><div data-reactroot=""><header class="Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="content"><article><span>2018-07-03</span><h1>static.config.jsでwebpackのrulesを変更した時のエラーの対処法</h1><ul class="PostTags"><li class="PostTags-li"><a class="PostTags-Link" href="/tags/ReactStatic">ReactStatic</a> </li><li class="PostTags-li"><a class="PostTags-Link" href="/tags/webpack">webpack</a> </li></ul><div><h2>rulesを変更して<code>npm run build</code>するとエラーに</h2>
<p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中(<code>npm run start</code>)では問題はないが、プロダクションビルド(<code>npm run build</code>)するとエラーになるのでその対処法をメモして置く。</p>
<pre><code class="hljs lang-shell"><span class="hljs-meta">$</span><span class="bash"> npm run build</span>
<span class="hljs-meta">#</span><span class="bash"> ...</span>
Error: Module build failed: Error: "extract-text-webpack-plugin" loader is used 
without the  corresponding plugin, refer to 
https://github.com/webpack/extract-text-webpack-plugin for th  e usage example</code></pre>
<p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p>
<pre><code class="hljs lang-js"><span class="hljs-comment">// static.config.js</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// ...</span>
  webpack: <span class="hljs-function">(<span class="hljs-params">config, { defaultLoaders }</span>) =&gt;</span> {
    config.module.rules = [{
      <span class="hljs-attr">oneOf</span>: [
        <span class="hljs-comment">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>
        defaultLoaders.jsLoader,
        defaultLoaders.cssLoader,
        defaultLoaders.fileLoader,
      ],
    }]

    <span class="hljs-keyword">return</span> config
  }
}</code></pre>
<p>デフォルトとは一体…</p>
<p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p>
<h2>暫定的対処法</h2>
<p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p>
<pre><code class="hljs lang-js"><span class="hljs-comment">// static.config.js</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// ...</span>
  webpack: <span class="hljs-function">(<span class="hljs-params">config, { defaultLoaders }</span>) =&gt;</span> {
    config.resolve.extensions.push(<span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.tsx'</span>)

    config.module.rules[<span class="hljs-number">0</span>].oneOf.unshift({
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(js|jsx|ts|tsx)$/</span>,
      <span class="hljs-attr">exclude</span>: defaultLoaders.jsLoader.exclude, <span class="hljs-comment">// as std jsLoader exclude</span>
      use: [
        { <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span> },
        {
          <span class="hljs-attr">loader</span>: <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">'ts-loader'</span>),
          <span class="hljs-attr">options</span>: { <span class="hljs-attr">transpileOnly</span>: <span class="hljs-literal">true</span> },
        },
      ],
    })

    <span class="hljs-keyword">return</span> config
  },
}</code></pre>
<p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>
</div></article><div class="PostPager"><div class="PostPager-item"></div><div class="PostPager-item"><a class="active" aria-current="page" href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/deploy-to-github-pages-user-page">GitHub PagesのUser Pageにdistフォルダをデプロイする</a></div></div></div></div></div><script type="text/javascript">window.__CSS_CHUNKS__ = {"main":"/styles.37921a17.css"}</script><script type="text/javascript">
    window.__routeInfo = {"path":"blog/webpacks-rules-in-static-config-js","templateID":2,"sharedPropsHashes":{},"localProps":null,"allProps":{"post":{"title":"static.config.jsでwebpackのrulesを変更した時のエラーの対処法","slug":"webpacks-rules-in-static-config-js","tags":["ReactStatic","webpack"],"date":"2018-07-03","contents":"<h2>rulesを変更して<code>npm run build</code>するとエラーに</h2>\n<p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。<br>サンプルは開発中(<code>npm run start</code>)では問題はないが、プロダクションビルド(<code>npm run build</code>)するとエラーになるのでその対処法をメモして置く。</p>\n<pre><code class=\"hljs lang-shell\"><span class=\"hljs-meta\">$</span><span class=\"bash\"> npm run build</span>\n<span class=\"hljs-meta\">#</span><span class=\"bash\"> ...</span>\nError: Module build failed: Error: \"extract-text-webpack-plugin\" loader is used \nwithout the  corresponding plugin, refer to \nhttps://github.com/webpack/extract-text-webpack-plugin for th  e usage example</code></pre>\n<p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p>\n<pre><code class=\"hljs lang-js\"><span class=\"hljs-comment\">// static.config.js</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  <span class=\"hljs-comment\">// ...</span>\n  webpack: <span class=\"hljs-function\">(<span class=\"hljs-params\">config, { defaultLoaders }</span>) =&gt;</span> {\n    config.module.rules = [{\n      <span class=\"hljs-attr\">oneOf</span>: [\n        <span class=\"hljs-comment\">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>\n        defaultLoaders.jsLoader,\n        defaultLoaders.cssLoader,\n        defaultLoaders.fileLoader,\n      ],\n    }]\n\n    <span class=\"hljs-keyword\">return</span> config\n  }\n}</code></pre>\n<p>デフォルトとは一体…</p>\n<p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。<br><code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p>\n<h2>暫定的対処法</h2>\n<p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。<br>ルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p>\n<pre><code class=\"hljs lang-js\"><span class=\"hljs-comment\">// static.config.js</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  <span class=\"hljs-comment\">// ...</span>\n  webpack: <span class=\"hljs-function\">(<span class=\"hljs-params\">config, { defaultLoaders }</span>) =&gt;</span> {\n    config.resolve.extensions.push(<span class=\"hljs-string\">'.ts'</span>, <span class=\"hljs-string\">'.tsx'</span>)\n\n    config.module.rules[<span class=\"hljs-number\">0</span>].oneOf.unshift({\n      <span class=\"hljs-attr\">test</span>: <span class=\"hljs-regexp\">/\\.(js|jsx|ts|tsx)$/</span>,\n      <span class=\"hljs-attr\">exclude</span>: defaultLoaders.jsLoader.exclude, <span class=\"hljs-comment\">// as std jsLoader exclude</span>\n      use: [\n        { <span class=\"hljs-attr\">loader</span>: <span class=\"hljs-string\">'babel-loader'</span> },\n        {\n          <span class=\"hljs-attr\">loader</span>: <span class=\"hljs-built_in\">require</span>.resolve(<span class=\"hljs-string\">'ts-loader'</span>),\n          <span class=\"hljs-attr\">options</span>: { <span class=\"hljs-attr\">transpileOnly</span>: <span class=\"hljs-literal\">true</span> },\n        },\n      ],\n    })\n\n    <span class=\"hljs-keyword\">return</span> config\n  },\n}</code></pre>\n<p>現在はこのような設定になっている。<br>あまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>\n"},"next":{"title":"GitHub PagesのUser Pageにdistフォルダをデプロイする","slug":"deploy-to-github-pages-user-page"}},"siteData":{}};</script><script defer="" type="text/javascript" src="/bootstrap.920b863d.js"></script><script defer="" type="text/javascript" src="/templates/src/containers/Post.e0cce4a8.js"></script><script defer="" type="text/javascript" src="/main.1a0e896c.js"></script></body></html>