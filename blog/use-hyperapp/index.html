<!DOCTYPE html><html lang="ja-JP" prefix="og: http://ogp.me/ns#"><head> <link href="/src.014556d8.js" rel="preload" as="script"> <meta charset="UTF-8"> <meta content="width=device-width,initial-scale=1" name="viewport"> <meta content="ie=edge" http-equiv="X-UA-Compatible"> <style>
 .PostTags,.PostTags-li{display:inline;padding:0;margin:0}.PostTags-Link{color:#6c6c6c}.Header{background:#108db8;box-shadow:0 5px 15px -5px rgba(0,0,0,.8)}.Header-title{margin:0;padding:1rem;text-align:center}.Header-title a{color:#fff}body{font-family:HelveticaNeue-Light,Helvetica Neue Light,Helvetica Neue,Helvetica,Arial,Lucida Grande,sans-serif;font-weight:300;font-size:16px;margin:0;padding:0}a{text-decoration:none;color:#108db8;font-weight:700}h2{border-bottom:1px solid #6c6c6c;border-right:1px solid #6c6c6c;padding-left:.5em}.App{display:flex;flex-direction:column;min-height:100vh}.content{flex:1;box-sizing:border-box;width:100%;max-width:700px;padding:0 1rem;margin:2rem auto}code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}pre[class*=language-]{background:#f5f2f0}.token.deleted{color:#905}.token.inserted{color:#690}
</style>
<link href="/src.f1b0ffda.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link href="/src.f1b0ffda.css" rel="stylesheet"></noscript>
<script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var o=loadCSS.relpreload={};if(o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},!o.support()){o.poly();var t=n.setInterval(o.poly,500);n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this);</script><script src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74494516-4")</script><title>【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX</title><meta content="作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。" name="description"><meta content="【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX" property="og:title"><meta content="article" property="og:type"><meta content="作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。" property="og:description"><meta content="https://imasanari.github.io/blog/use-hyperapp/" property="og:url"><meta content="https://imasanari.github.io/images/hyperapp.png" property="og:image"><meta content="summary" name="twitter:card"></head> <body> <div id="app"><div class="App"><header class="Header"><h1 class="Header-title"><a href="/">Tech SANDBOX</a></h1></header><div class="content"><div><article><span>2018-07-12</span><h1>【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話</h1><ul class="PostTags"><li class="PostTags-li"><a href="/tags/blog/" class="PostTags-Link"> #blog</a></li><li class="PostTags-li"><a href="/tags/Hyperapp/" class="PostTags-Link"> #Hyperapp</a></li></ul><div><h2 id="-">はじめに</h2><p>作ったばかりのこのブログだが、<a href="https://github.com/hyperapp/hyperapp" rel="noopener" target="_blank">Hyperapp</a>ベースのstaticでSPAなサイトに変更した。<br><a href="https://github.com/nozzle/react-static" rel="noopener" target="_blank">React Static</a>を使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。</p><h2 id="-">なぜ変更したのか</h2><ul><li><a href="/blog/use-technology/">ブログで使用した技術</a>の通り<ul><li><a href="https://github.com/hyperapp/hyperapp" rel="noopener" target="_blank">Hyperapp</a>があるじゃんとなったのがきっかけ</li></ul></li><li>ブログではstateやactionがページ遷移関係でしか使っていないことに気づいた<ul><li>全て<a href="https://github.com/nozzle/react-static" rel="noopener" target="_blank">React Static</a>に隠されている</li></ul></li><li>車輪の再発明が好き</li></ul><h2 id="-">移行について</h2><h3 id="view-">View部分</h3><p>jsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。</p><pre class="language-diff"><code class="language-diff"><span class="token deleted">-import React from 'react'</span>
<span class="token deleted">-import { Link } from 'react-static'</span>
<span class="token inserted">+import { h } from 'hyperapp'</span>
<span class="token inserted">+import { Link } from '@hyperapp/router'</span>

 // 中略

<span class="token deleted">-export default withRouteData(</span>
<span class="token deleted">-  ({ posts }: Props) =></span>
<span class="token deleted">-    &lt;div className=""></span>
<span class="token inserted">+export default ({ posts }: Props) =></span>
<span class="token inserted">+  &lt;div class=""></span>

 // 後略
</code></pre><p>コンポーネントで実際に変更したのはこのくらい。</p><h3 id="-">ビルドスクリプトはなんとかなる</h3><p>なんとかなった。</p><p><code>requireWithRollup</code>関数を作れたのが大きい。</p><pre class="language-js"><code class="language-js"><span class="token comment">// rollupのpluginを適用してrequireできる</span>
<span class="token keyword">const</span> Template <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requireWithRollup</span><span class="token punctuation">(</span><span class="token string">'./src/Template.tsx'</span><span class="token punctuation">,</span> rollupConfig<span class="token punctuation">)</span>
</code></pre><p>実装は<a href="https://github.com/iMasanari/imasanari.github.io/blob/use-hyperapp/scripts/requireWithRollup.js" rel="noopener" target="_blank">ここ</a>。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。</p><p>設定ファイルやビルド方法は<a href="https://github.com/nozzle/react-static" rel="noopener" target="_blank">React Static</a>を<s>パクった</s>かなり参考にした。</p><h2 id="-">ルーティング、およびページ遷移部分</h2><p>ここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。</p><h2 id="-">未実装部分</h2><p>ページ遷移周りが適当</p><ul><li>ページプリキャッシュ部分<ul><li>現在はリンククリック時にjson読み込み</li><li>prefetchやpreloadで先読み？　それともServise Workerを使う？</li><li>スクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも<ul><li>【追記】この方法で仮実装</li></ul></li></ul></li><li>iPhoneでスワイプして戻るとちらつく<ul><li>前画面のデータをキャッシュしててもダメ</li><li><a href="https://github.com/nozzle/react-static" rel="noopener" target="_blank">React Static</a>の時には起こらなかった</li></ul></li></ul><h2 id="-">やるかどうかわからない</h2><p>ジェネレータ部分を分離</p></div></article><div class="PostPager"><div class="PostPager-item"><a href="/blog/remove-object-key/">【ES.next】Objectから任意のキーを削除した新しいObjectを作成する</a></div><div class="PostPager-item"><a href="/">HOME</a></div><div class="PostPager-item"><a href="/blog/webpacks-rules-in-static-config-js/">React StaticでTypeScriptを使用した時のエラー対処法</a></div></div><aside><div class="AsidePosts-title">同じタグを含む記事</div><ul class="PostTags"><li class="PostTags-li"><a href="/tags/blog/" class="PostTags-Link"> #blog</a></li><li class="PostTags-li"><a href="/tags/Hyperapp/" class="PostTags-Link"> #Hyperapp</a></li></ul><ul class="AsidePosts-ul"><li class="AsidePosts-li"><a href="/blog/use-technology/">ブログで使用した技術</a><ul class="PostTags"><li class="PostTags-li"><a href="/tags/blog/" class="PostTags-Link"> #blog</a></li></ul></li><li class="AsidePosts-li"><a href="/blog/first-post/">react-strictでブログ作成しました</a><ul class="PostTags"><li class="PostTags-li"><a href="/tags/blog/" class="PostTags-Link"> #blog</a></li></ul></li></ul></aside></div></div><footer class="Footer"><p>Author: <a href="https://github.com/iMasanari">iMasanari</a></p><small><a href="https://github.com/iMasanari/imasanari.github.io/">> Blog Repository &lt;</a></small></footer></div></div><script>var __data={component:1,title:"【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX",props:{post:{title:"【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話",description:"作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。",slug:"use-hyperapp",tags:["blog","Hyperapp"],image:"/images/hyperapp.png",date:"2018-07-12",contents:"<h2 id=->はじめに</h2><p>作ったばかりのこのブログだが、<a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>ベースのstaticでSPAなサイトに変更した。<br><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。</p><h2 id=->なぜ変更したのか</h2><ul><li><a href=/blog/use-technology/ >ブログで使用した技術</a>の通り<ul><li><a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>があるじゃんとなったのがきっかけ</li></ul></li><li>ブログではstateやactionがページ遷移関係でしか使っていないことに気づいた<ul><li>全て<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>に隠されている</li></ul></li><li>車輪の再発明が好き</li></ul><h2 id=->移行について</h2><h3 id=view->View部分</h3><p>jsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。</p><pre class=language-diff><code class=language-diff><span class='token deleted'>-import React from 'react'</span>\n<span class='token deleted'>-import { Link } from 'react-static'</span>\n<span class='token inserted'>+import { h } from 'hyperapp'</span>\n<span class='token inserted'>+import { Link } from '@hyperapp/router'</span>\n\n // 中略\n\n<span class='token deleted'>-export default withRouteData(</span>\n<span class='token deleted'>-  ({ posts }: Props) =></span>\n<span class='token deleted'>-    &lt;div className=\"\"></span>\n<span class='token inserted'>+export default ({ posts }: Props) =></span>\n<span class='token inserted'>+  &lt;div class=\"\"></span>\n\n // 後略\n</code></pre><p>コンポーネントで実際に変更したのはこのくらい。</p><h3 id=->ビルドスクリプトはなんとかなる</h3><p>なんとかなった。</p><p><code>requireWithRollup</code>関数を作れたのが大きい。</p><pre class=language-js><code class=language-js><span class='token comment'>// rollupのpluginを適用してrequireできる</span>\n<span class='token keyword'>const</span> Template <span class='token operator'>=</span> <span class='token keyword'>await</span> <span class='token function'>requireWithRollup</span><span class='token punctuation'>(</span><span class='token string'>'./src/Template.tsx'</span><span class='token punctuation'>,</span> rollupConfig<span class='token punctuation'>)</span>\n</code></pre><p>実装は<a href=https://github.com/iMasanari/imasanari.github.io/blob/use-hyperapp/scripts/requireWithRollup.js rel=noopener target=_blank>ここ</a>。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。</p><p>設定ファイルやビルド方法は<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を<s>パクった</s>かなり参考にした。</p><h2 id=->ルーティング、およびページ遷移部分</h2><p>ここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。</p><h2 id=->未実装部分</h2><p>ページ遷移周りが適当</p><ul><li>ページプリキャッシュ部分<ul><li>現在はリンククリック時にjson読み込み</li><li>prefetchやpreloadで先読み？　それともServise Workerを使う？</li><li>スクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも<ul><li>【追記】この方法で仮実装</li></ul></li></ul></li><li>iPhoneでスワイプして戻るとちらつく<ul><li>前画面のデータをキャッシュしててもダメ</li><li><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>の時には起こらなかった</li></ul></li></ul><h2 id=->やるかどうかわからない</h2><p>ジェネレータ部分を分離</p>"},prev:{title:"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する",slug:"remove-object-key"},next:{title:"React StaticでTypeScriptを使用した時のエラー対処法",slug:"webpacks-rules-in-static-config-js"},sameTags:[{title:"ブログで使用した技術",slug:"use-technology",date:"2018-06-30",tags:["blog","React","preact","TypeScript","ReactStatic"]},{title:"react-strictでブログ作成しました",slug:"first-post",date:"2018-06-29",tags:["blog"]}]}}</script> <script src="/src.014556d8.js"></script>  </body></html>