<!DOCTYPE html><html lang=ja-JP prefix="og: http://ogp.me/ns#"><head><script src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74494516-4")</script><link href=/bundle.jk550k1p.js rel=preload as=script><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="ie=edge" http-equiv=X-UA-Compatible><title>【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX</title><link href=/bundle.jk550k1p.css rel=stylesheet><meta content="【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX" property=og:title><meta content=article property=og:type><meta content="作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。" property=og:description><meta content=https://imasanari.github.io/blog/use-hyperapp property=og:url><meta content=https://imasanari.github.io/images/hyperapp.png property=og:image><meta content=summary name=twitter:card></head><body><div class=App><header class=Header><h1 class=Header-title><a href=/ >Tech SANDBOX</a></h1></header><div class=content><div><article><span>2018-07-12</span><h1>【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話</h1><ul class=PostTags><li class=PostTags-li><a href=/tags/blog/ class=PostTags-Link>blog</a> </li><li class=PostTags-li><a href=/tags/Hyperapp/ class=PostTags-Link>Hyperapp</a> </li></ul><div><h2>はじめに</h2><p>作ったばかりのこのブログだが、<a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>で動くstaticでSPAなサイトに変更した。<br><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。</p><h2>なぜ変更したのか</h2><ul><li><a href=/blog/use-technology/ >ブログで使用した技術</a>の通り<ul><li><a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>があるじゃんとなったのがきっかけ</li></ul></li><li>ブログではstateやactionがページ遷移関係でしか使っていないことに気づいた<ul><li>全て<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>に隠されている</li></ul></li><li>車輪の再発明が好き</li></ul><h2>移行について</h2><h3>View部分</h3><p>jsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。</p><pre class=language-diff><code class=language-diff><span class="token deleted">-import React from 'react'</span>
<span class="token deleted">-import { Link } from 'react-static'</span>
<span class="token inserted">+import { h } from 'hyperapp'</span>
<span class="token inserted">+import { Link } from '@hyperapp/router'</span>

 // 中略

<span class="token deleted">-export default withRouteData(</span>
<span class="token deleted">-  ({ posts }: Props) =></span>
<span class="token deleted">-    &lt;div className=""></span>
<span class="token inserted">+export default ({ posts }: Props) =></span>
<span class="token inserted">+  &lt;div class=""></span>

 // 後略
</code></pre><p>コンポーネントで実際に変更したのはこのくらい。</p><h3>ビルドスクリプトはなんとかなる</h3><p>なんとかなった。</p><p><code>requireWithRollup</code>関数を作れたのが大きい。</p><pre class=language-js><code class=language-js><span class="token comment">// rollupのpluginを適用してrequireできる</span>
<span class="token keyword">const</span> Template <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requireWithRollup</span><span class="token punctuation">(</span><span class="token string">'./src/Template.tsx'</span><span class="token punctuation">,</span> rollupConfig<span class="token punctuation">)</span>
</code></pre><p>実装は<a href=https://github.com/iMasanari/imasanari.github.io/blob/use-hyperapp/scripts/requireWithRollup.js rel=noopener target=_blank>ここ</a>。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。</p><p>設定ファイルやビルド方法は<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を<s>パクった</s>かなり参考にした。</p><h2>ルーティング、およびページ遷移部分</h2><p>ここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。</p><h2>未実装部分</h2><p>ページ遷移周りが適当</p><ul><li>ページプリキャッシュ部分<ul><li>現在はリンククリック時にjson読み込み</li><li>prefetchやpreloadで先読み？ それともServise Workerを使う？</li><li>スクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも<ul><li>【追記】この方法で仮実装</li></ul></li></ul></li><li>iPhoneでスワイプして戻るとちらつく<ul><li>前画面のデータをキャッシュしててもダメ</li><li><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>の時には起こらなかった</li></ul></li></ul><h2>やるかどうかわからない</h2><p>ジェネレータ部分を分離</p></div></article><div class=PostPager><div class=PostPager-item><a href=/blog/remove-object-key/ >【ES.next】Objectから任意のキーを削除した新しいObjectを作成する</a></div><div class=PostPager-item><a href=/ >HOME</a></div><div class=PostPager-item><a href=/blog/webpacks-rules-in-static-config-js/ >React StaticでTypeScriptを使用した時のエラー対処法</a></div></div></div></div><footer class=Footer><p>Author: <a href=https://github.com/iMasanari>iMasanari</a></p><small><a href=https://github.com/iMasanari/imasanari.github.io/ >&gt; Blog Repository &lt;</a></small></footer></div><script>var __data={component:1,title:"【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話 - Tech SANDBOX",props:{post:{title:"【書き途中】ブログをHyperappベースの自作ジェネレータに変更した話",description:"作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。",slug:"use-hyperapp",tags:["blog","Hyperapp"],image:"/images/hyperapp.png",date:"2018-07-12",contents:"<h2>はじめに</h2><p>作ったばかりのこのブログだが、<a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>で動くstaticでSPAなサイトに変更した。<br><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。</p><h2>なぜ変更したのか</h2><ul><li><a href=/blog/use-technology/ >ブログで使用した技術</a>の通り<ul><li><a href=https://github.com/hyperapp/hyperapp rel=noopener target=_blank>Hyperapp</a>があるじゃんとなったのがきっかけ</li></ul></li><li>ブログではstateやactionがページ遷移関係でしか使っていないことに気づいた<ul><li>全て<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>に隠されている</li></ul></li><li>車輪の再発明が好き</li></ul><h2>移行について</h2><h3>View部分</h3><p>jsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。</p><pre class=language-diff><code class=language-diff><span class='token deleted'>-import React from 'react'</span>\n<span class='token deleted'>-import { Link } from 'react-static'</span>\n<span class='token inserted'>+import { h } from 'hyperapp'</span>\n<span class='token inserted'>+import { Link } from '@hyperapp/router'</span>\n\n // 中略\n\n<span class='token deleted'>-export default withRouteData(</span>\n<span class='token deleted'>-  ({ posts }: Props) =></span>\n<span class='token deleted'>-    &lt;div className=\"\"></span>\n<span class='token inserted'>+export default ({ posts }: Props) =></span>\n<span class='token inserted'>+  &lt;div class=\"\"></span>\n\n // 後略\n</code></pre><p>コンポーネントで実際に変更したのはこのくらい。</p><h3>ビルドスクリプトはなんとかなる</h3><p>なんとかなった。</p><p><code>requireWithRollup</code>関数を作れたのが大きい。</p><pre class=language-js><code class=language-js><span class='token comment'>// rollupのpluginを適用してrequireできる</span>\n<span class='token keyword'>const</span> Template <span class='token operator'>=</span> <span class='token keyword'>await</span> <span class='token function'>requireWithRollup</span><span class='token punctuation'>(</span><span class='token string'>'./src/Template.tsx'</span><span class='token punctuation'>,</span> rollupConfig<span class='token punctuation'>)</span>\n</code></pre><p>実装は<a href=https://github.com/iMasanari/imasanari.github.io/blob/use-hyperapp/scripts/requireWithRollup.js rel=noopener target=_blank>ここ</a>。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。</p><p>設定ファイルやビルド方法は<a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>を<s>パクった</s>かなり参考にした。</p><h2>ルーティング、およびページ遷移部分</h2><p>ここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。</p><h2>未実装部分</h2><p>ページ遷移周りが適当</p><ul><li>ページプリキャッシュ部分<ul><li>現在はリンククリック時にjson読み込み</li><li>prefetchやpreloadで先読み？ それともServise Workerを使う？</li><li>スクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも<ul><li>【追記】この方法で仮実装</li></ul></li></ul></li><li>iPhoneでスワイプして戻るとちらつく<ul><li>前画面のデータをキャッシュしててもダメ</li><li><a href=https://github.com/nozzle/react-static rel=noopener target=_blank>React Static</a>の時には起こらなかった</li></ul></li></ul><h2>やるかどうかわからない</h2><p>ジェネレータ部分を分離</p>"},prev:{title:"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する",slug:"remove-object-key"},next:{title:"React StaticでTypeScriptを使用した時のエラー対処法",slug:"webpacks-rules-in-static-config-js"}}}</script><script src=/bundle.jk550k1p.js></script></body></html>