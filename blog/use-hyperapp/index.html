<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>ブログをHyperappベースの自作ジェネレータに変更した話 | Tech SANDBOX</title><meta name="description" content="作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。"/><meta property="og:title" content="ブログをHyperappベースの自作ジェネレータに変更した話"/><meta property="og:description" content="作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。"/><meta property="og:type" content="article"/><meta property="og:url" content="https://imasanari.github.io/blog/use-hyperapp"/><meta property="og:image" content="https://imasanari.github.io/images/icon.jpg"/><meta property="og:site_name" content="Tech SANDBOX"/><meta name="twitter:card" content="summary"/><meta name="next-head-count" content="11"/><link rel="preload" href="/_next/static/css/d4bd6111bf22fa15fd71.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d4bd6111bf22fa15fd71.css"/><link rel="preload" href="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.6c6c2144b5674c37af03.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.65195c3ca934dc067d4c.js" as="script"/><link rel="preload" href="/_next/static/chunks/750b2726a69f361bcb8ab59f8396713b1d057f97.eb739be10f1a321b366c.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-970c9d204f95e252b248.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-dbdb6dab1991e2a52bd5.js" as="script"/><style id="__jsx-2257550242">.SiteTitle.jsx-2257550242{font-size:2rem;margin:1rem 0;}</style><style id="__jsx-1424798431">.Tags.jsx-1424798431{padding:0;}.item.jsx-1424798431{display:inline;margin:0 0.2em;}.link.jsx-1424798431{color:var(--color-text-secondary);}</style><style id="__jsx-2638938446">.PostPager.jsx-2638938446{display:table;max-width:var(--width-content);margin:2rem auto;}.item.jsx-2638938446{box-sizing:border-box;display:table-cell;width:33.3%;padding:0.5rem;text-align:center;vertical-align:middle;}.home.jsx-2638938446{border-left:1px solid #6c6c6c;border-right:1px solid #6c6c6c;}</style><style id="__jsx-2000003725">.Posts.jsx-2000003725{list-style:none;padding:0;}.Posts-item.jsx-2000003725{padding:1rem 1.5rem;margin:1rem 0;border:1px solid #bbb;}</style><style id="__jsx-101915585">.Footer.jsx-101915585{text-align:center;}</style><style id="__jsx-2377730788">main{display:block;}header+main{padding-top:0;}header:last-child{padding-bottom:0;}pre{overflow:auto;max-width:none;padding:0.5rem 2rem;background:#272822;}pre code,pre samp{display:inline;padding:0;}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string{background:transparent;}@media (prefers-color-scheme:dark){:root{--color:#0097fc;--color-accent:#0097fc4f;--color-bg:#333;--color-bg-secondary:#555;--color-secondary:#e20de9;--color-secondary-accent:#e20de94f;--color-shadow:#bbbbbb20;--color-text:#f7f7f7;--color-text-secondary:#aaa;}}</style></head><body><div id="__next"><header><div class="jsx-2257550242 SiteTitle"><a class="jsx-2257550242" href="/">Tech SANDBOX</a></div><p>技術ブログ改め、Qiitaの下書き</p></header><div><article><header><time dateTime="2018-07-12T12:45:07.379Z">2018-07-12</time><h1>ブログをHyperappベースの自作ジェネレータに変更した話</h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/blog/">#<!-- -->blog</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/Hyperapp/">#<!-- -->Hyperapp</a></li></ul></header><main><div><h2 id="はじめに">はじめに</h2><p>作ったばかりのこのブログだが、<a href="https://github.com/hyperapp/hyperapp">Hyperapp</a>ベースのstaticでSPAなサイトに変更した。
<a href="https://github.com/nozzle/react-static">React Static</a>を使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。</p><h2 id="なぜ変更したのか">なぜ変更したのか</h2><ul><li><a href="/blog/use-technology/">ブログで使用した技術</a>の通り<ul><li><a href="https://github.com/hyperapp/hyperapp">Hyperapp</a>があるじゃんとなったのがきっかけ</li></ul></li><li>ブログではstateやactionがページ遷移関係でしか使っていないことに気づいた<ul><li>全て<a href="https://github.com/nozzle/react-static">React Static</a>に隠されている</li></ul></li><li>車輪の再発明が好き</li></ul><h2 id="移行について">移行について</h2><h3 id="view部分">View部分</h3><p>jsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。</p><pre><code class="language-diff" data-language="diff" data-highlighted-line-numbers=""><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">import React from 'react'
</span><span class="token prefix deleted">-</span><span class="token line">import { Link } from 'react-static'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import { h } from 'hyperapp'
</span><span class="token prefix inserted">+</span><span class="token line">import { Link } from '@hyperapp/router'
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">// 中略
</span></span>
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">export default withRouteData(
</span><span class="token prefix deleted">-</span><span class="token line">  ({ posts }: Props) =>
</span><span class="token prefix deleted">-</span><span class="token line">    &lt;div className="">
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">export default ({ posts }: Props) =>
</span><span class="token prefix inserted">+</span><span class="token line">  &lt;div class="">
</span></span>
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">// 後略
</span></span></code></pre><p>コンポーネントで実際に変更したのはこのくらい。</p><h3 id="ビルドスクリプトはなんとかなる">ビルドスクリプトはなんとかなる</h3><p>なんとかなった。</p><p><code>requireWithRollup</code>関数を作れたのが大きい。</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token comment">// rollupのpluginを適用してrequireできる</span>
<span class="token keyword">const</span> Template <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requireWithRollup</span><span class="token punctuation">(</span><span class="token string">'./src/Template.tsx'</span><span class="token punctuation">,</span> rollupConfig<span class="token punctuation">)</span>
</code></pre><p>実装は<a href="https://github.com/iMasanari/imasanari.github.io/blob/9ab02e264623038b6d296fa0b0a6171be93907ee/scripts/requireWithRollup.js">ここ</a>。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。</p><p>設定ファイルやビルド方法は<a href="https://github.com/nozzle/react-static">React Static</a>を<s>パクった</s>かなり参考にした。</p><h2 id="ルーティング、およびページ遷移部分">ルーティング、およびページ遷移部分</h2><p>ここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。</p><h2 id="未実装部分">未実装部分</h2><p>ページ遷移周りが適当</p><ul><li>ページプリキャッシュ部分<ul><li>現在はリンククリック時にjson読み込み</li><li>prefetchやpreloadで先読み？　それともServise Workerを使う？</li><li>スクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも<ul><li>【追記】この方法で仮実装</li></ul></li></ul></li><li>iPhoneでスワイプして戻るとちらつく<ul><li>前画面のデータをキャッシュしててもダメ</li><li><a href="https://github.com/nozzle/react-static">React Static</a>の時には起こらなかった</li></ul></li></ul><h2 id="やるかどうかわからない">やるかどうかわからない</h2><p>ジェネレータ部分を分離</p></div></main></article><div class="jsx-2638938446 PostPager"><div class="jsx-2638938446 item"><a class="jsx-2638938446" href="/blog/webpacks-rules-in-static-config-js/">React StaticでTypeScriptを使用した時のエラー対処法</a></div><div class="jsx-2638938446 item home"><a class="jsx-2638938446" href="/">HOME</a></div><div class="jsx-2638938446 item"><a class="jsx-2638938446" href="/blog/remove-object-key/">【ES.next】Objectから任意のキーを削除した新しいObjectを作成する</a></div></div><aside><header><h1>同じタグを含む記事</h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/blog/">#<!-- -->blog</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/Hyperapp/">#<!-- -->Hyperapp</a></li></ul></header><main><ul class="jsx-2000003725 Posts"><li class="jsx-2000003725 Posts-item"><article class="jsx-2000003725"><header><time dateTime="2020-09-20T06:33:49.199Z">2020-09-20</time><h1><a href="/blog/use-next/">ブログをNext.jsベースに変更した</a></h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/React/">#<!-- -->React</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/Next.js">#<!-- -->Next.js</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/blog/">#<!-- -->blog</a></li></ul></header></article></li><li class="jsx-2000003725 Posts-item"><article class="jsx-2000003725"><header><time dateTime="2019-04-26T13:55:56.097Z">2019-04-26</time><h1><a href="/blog/use-parcel/">ブログ開発をParcelに変更した</a></h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/parcel/">#<!-- -->parcel</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/blog/">#<!-- -->blog</a></li></ul></header></article></li><li class="jsx-2000003725 Posts-item"><article class="jsx-2000003725"><header><time dateTime="2018-06-30T14:52:29.225Z">2018-06-30</time><h1><a href="/blog/use-technology/">ブログで使用した技術</a></h1><ul class="jsx-1424798431 Tags"><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/blog/">#<!-- -->blog</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/React/">#<!-- -->React</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/preact/">#<!-- -->preact</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/TypeScript/">#<!-- -->TypeScript</a></li><li class="jsx-1424798431 item"><a class="jsx-1424798431 link" href="/tags/ReactStatic/">#<!-- -->ReactStatic</a></li></ul></header></article></li></ul></main></aside></div><footer class="jsx-101915585 Footer"><p class="jsx-101915585">Author: <a href="https://github.com/iMasanari" class="jsx-101915585">iMasanari</a></p><small class="jsx-101915585"><a href="https://github.com/iMasanari/imasanari.github.io/" class="jsx-101915585">Show on GitHub</a></small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ブログをHyperappベースの自作ジェネレータに変更した話","description":"作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。","slug":"use-hyperapp","tags":["blog","Hyperapp"],"image":"/images/hyperapp.png","date":"2018-07-12T12:45:07.379Z","body":"\u003ch2 id=\"はじめに\"\u003eはじめに\u003c/h2\u003e\u003cp\u003e作ったばかりのこのブログだが、\u003ca href=\"https://github.com/hyperapp/hyperapp\"\u003eHyperapp\u003c/a\u003eベースのstaticでSPAなサイトに変更した。\n\u003ca href=\"https://github.com/nozzle/react-static\"\u003eReact Static\u003c/a\u003eを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。\u003c/p\u003e\u003ch2 id=\"なぜ変更したのか\"\u003eなぜ変更したのか\u003c/h2\u003e\u003cul\u003e\u003cli\u003e\u003ca href=\"/blog/use-technology/\"\u003eブログで使用した技術\u003c/a\u003eの通り\u003cul\u003e\u003cli\u003e\u003ca href=\"https://github.com/hyperapp/hyperapp\"\u003eHyperapp\u003c/a\u003eがあるじゃんとなったのがきっかけ\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eブログではstateやactionがページ遷移関係でしか使っていないことに気づいた\u003cul\u003e\u003cli\u003e全て\u003ca href=\"https://github.com/nozzle/react-static\"\u003eReact Static\u003c/a\u003eに隠されている\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003e車輪の再発明が好き\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"移行について\"\u003e移行について\u003c/h2\u003e\u003ch3 id=\"view部分\"\u003eView部分\u003c/h3\u003e\u003cp\u003ejsxが流用できたのでView部分は楽だった。もともとSFCのみでクラスコンポーネントがほぼない。メインコンテンツである記事はmarkdown管理なので問題なし。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-diff\" data-language=\"diff\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token deleted-sign deleted\"\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003eimport React from 'react'\n\u003c/span\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003eimport { Link } from 'react-static'\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003eimport { h } from 'hyperapp'\n\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003eimport { Link } from '@hyperapp/router'\n\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e// 中略\n\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token deleted-sign deleted\"\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003eexport default withRouteData(\n\u003c/span\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003e  ({ posts }: Props) =\u003e\n\u003c/span\u003e\u003cspan class=\"token prefix deleted\"\u003e-\u003c/span\u003e\u003cspan class=\"token line\"\u003e    \u0026lt;div className=\"\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003eexport default ({ posts }: Props) =\u003e\n\u003c/span\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003e\u003cspan class=\"token line\"\u003e  \u0026lt;div class=\"\"\u003e\n\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e\u003cspan class=\"token line\"\u003e// 後略\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eコンポーネントで実際に変更したのはこのくらい。\u003c/p\u003e\u003ch3 id=\"ビルドスクリプトはなんとかなる\"\u003eビルドスクリプトはなんとかなる\u003c/h3\u003e\u003cp\u003eなんとかなった。\u003c/p\u003e\u003cp\u003e\u003ccode\u003erequireWithRollup\u003c/code\u003e関数を作れたのが大きい。\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-jsx\" data-language=\"jsx\" data-highlighted-line-numbers=\"\"\u003e\u003cspan class=\"token comment\"\u003e// rollupのpluginを適用してrequireできる\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e Template \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"token function\"\u003erequireWithRollup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'./src/Template.tsx'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e rollupConfig\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e実装は\u003ca href=\"https://github.com/iMasanari/imasanari.github.io/blob/9ab02e264623038b6d296fa0b0a6171be93907ee/scripts/requireWithRollup.js\"\u003eここ\u003c/a\u003e。rollup.jsが自身の設定ファイルを読み込む方法を参考にした。\u003c/p\u003e\u003cp\u003e設定ファイルやビルド方法は\u003ca href=\"https://github.com/nozzle/react-static\"\u003eReact Static\u003c/a\u003eを\u003cs\u003eパクった\u003c/s\u003eかなり参考にした。\u003c/p\u003e\u003ch2 id=\"ルーティング、およびページ遷移部分\"\u003eルーティング、およびページ遷移部分\u003c/h2\u003e\u003cp\u003eここが一番苦労している。エントリーポイントのindex.tsxがごちゃごちゃしてしまった。書き直すならここ。\u003c/p\u003e\u003ch2 id=\"未実装部分\"\u003e未実装部分\u003c/h2\u003e\u003cp\u003eページ遷移周りが適当\u003c/p\u003e\u003cul\u003e\u003cli\u003eページプリキャッシュ部分\u003cul\u003e\u003cli\u003e現在はリンククリック時にjson読み込み\u003c/li\u003e\u003cli\u003eprefetchやpreloadで先読み？　それともServise Workerを使う？\u003c/li\u003e\u003cli\u003eスクリプトが軽いのでいっそJSで雑に先読みしちゃうのもありかも\u003cul\u003e\u003cli\u003e【追記】この方法で仮実装\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003cli\u003eiPhoneでスワイプして戻るとちらつく\u003cul\u003e\u003cli\u003e前画面のデータをキャッシュしててもダメ\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://github.com/nozzle/react-static\"\u003eReact Static\u003c/a\u003eの時には起こらなかった\u003c/li\u003e\u003c/ul\u003e\u003c/li\u003e\u003c/ul\u003e\u003ch2 id=\"やるかどうかわからない\"\u003eやるかどうかわからない\u003c/h2\u003e\u003cp\u003eジェネレータ部分を分離\u003c/p\u003e"},"next":{"title":"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する","description":"ブログを作る前、Qiitaに投稿しようと書いていたけど途中でやめ、最近まで忘れていた記事です。Qiitaでもいいけど、せっかくだからこっちに置いておきます。","slug":"remove-object-key","tags":["JavaScript","Babel","TypeScript"],"date":"2018-07-13T12:47:36.148Z"},"prev":{"title":"React StaticでTypeScriptを使用した時のエラー対処法","description":"static.config.jsのwebpack設定を変更することで起こるエラーの対処法。","slug":"webpacks-rules-in-static-config-js","tags":["ReactStatic","TypeScript","webpack"],"date":"2018-07-03T11:47:13.910Z"},"sameTags":[{"title":"ブログをNext.jsベースに変更した","description":null,"slug":"use-next","tags":["React","Next.js","blog"],"date":"2020-09-20T06:33:49.199Z"},{"title":"ブログ開発をParcelに変更した","description":"前回の記事でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。決め手は、Tree Shakingがサポートされていたから。","slug":"use-parcel","tags":["parcel","blog"],"date":"2019-04-26T13:55:56.097Z"},{"title":"ブログで使用した技術","description":"この技術ブログで使用したライブラリやツールを紹介していきます。選定理由についても書きました。","slug":"use-technology","tags":["blog","React","preact","TypeScript","ReactStatic"],"date":"2018-06-30T14:52:29.225Z","update":"2019-04-20T13:15:27.878Z"}]},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"use-hyperapp"},"buildId":"SeXsfDXAcPxYFfuCjN3lT","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-a5b86a38e61b63f3b3a9.js"></script><script src="/_next/static/chunks/main-f01cf1dcca173d7f43b1.js" async=""></script><script src="/_next/static/chunks/webpack-ccf5ab034a524403276a.js" async=""></script><script src="/_next/static/chunks/framework.6c6c2144b5674c37af03.js" async=""></script><script src="/_next/static/chunks/commons.65195c3ca934dc067d4c.js" async=""></script><script src="/_next/static/chunks/750b2726a69f361bcb8ab59f8396713b1d057f97.eb739be10f1a321b366c.js" async=""></script><script src="/_next/static/chunks/pages/_app-970c9d204f95e252b248.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-dbdb6dab1991e2a52bd5.js" async=""></script><script src="/_next/static/SeXsfDXAcPxYFfuCjN3lT/_buildManifest.js" async=""></script><script src="/_next/static/SeXsfDXAcPxYFfuCjN3lT/_ssgManifest.js" async=""></script></body></html>