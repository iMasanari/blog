<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8" /><meta name="viewport" content="width=device-width" /><title>ブログをAMP対応（仮）しました | Tech SANDBOX</title><meta name="description" content="実質、各ページに `export const config = { amp: 'hybrid' }` を追加しただけ。next.js超ラク。" /><meta property="og:title" content="ブログをAMP対応（仮）しました" /><meta property="og:description" content="実質、各ページに `export const config = { amp: 'hybrid' }` を追加しただけ。next.js超ラク。" /><meta property="og:type" content="article" /><meta property="og:url" content="https://blog.imasanari.dev/blog/use-amp/" /><meta property="og:image" content="https://blog.imasanari.dev/images/icon.jpg" /><meta property="og:site_name" content="Tech SANDBOX" /><meta name="twitter:card" content="summary" /><meta name="next-head-count" content="11" /><meta charSet="utf-8" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74494516-4"></script><script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-74494516-4', {
  page_path: window.location.pathname,
});
</script><meta name="google-site-verification" content="UmWq3FQLg72H6H0Tlk-SFR9f0bSBsvC8nDmxtK3-qMc" /><meta name="next-font-preconnect" /><link rel="amphtml" href="/blog/use-amp.amp" /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer></script><script src="/_next/static/chunks/framework-da30cb0cd7d038e7.js" defer></script><script src="/_next/static/chunks/main-9fc370467ffab28e.js" defer></script><script src="/_next/static/chunks/pages/_app-d26166b7d1ee9cd4.js" defer></script><script src="/_next/static/chunks/510-ac06f49b3eddcc17.js" defer></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-061f89bddb2e1104.js" defer></script><script src="/_next/static/JVZsEND74mb34NnMWClVv/_buildManifest.js" defer></script><script src="/_next/static/JVZsEND74mb34NnMWClVv/_ssgManifest.js" defer></script><style data-emotion="c-global 15yblv4">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="c 1kyvigp 1ghlunn i9gxme 1x6wkub 1tqdl5x wb6uyc rntpfg 3zeruj zjuml4 1dmadst vubbuv i6s8oy 1qsxih2 1yjvs5a 1n6wxgb 1qh3bxa 16n8wpk 1ihubty ntfpy7 1vaygba 1f5kc47 y25xid ceho3e 1ugattu 15x2j1y 14rm9aa vlahzl 1lky7cb 1yipi07 1k33q06 12ogyw6 1f8td17 15kjgm 1aue7hj 1sl6rns f7hjxq 1bhrv1p mpp38z ze4krk 1jnynlu 1rvtlej 116qoqd 1d3ah2d fnf71d 19fxvs2">.c-1kyvigp{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#f5f5f5;color:rgba(0, 0, 0, 0.87);overflow:hidden;}@media print{.c-1kyvigp{position:absolute;}}.c-1ghlunn{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:600px){.c-1ghlunn{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.c-1ghlunn{max-width:1200px;}}@media (min-width:0px){@media (orientation: landscape){.c-1ghlunn{min-height:48px;}}}@media (min-width:600px){.c-1ghlunn{min-height:64px;}}.c-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}.c-1x6wkub{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}.c-1tqdl5x{margin:0;color:inherit;-webkit-text-decoration:none;text-decoration:none;color:inherit;}.c-wb6uyc{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.43;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}@media (min-width:0px){.c-rntpfg{display:none;}}@media (min-width:600px){.c-rntpfg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}.c-3zeruj{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:inherit;margin-left:24px;-webkit-text-decoration:underline;text-decoration:underline;color:inherit;}.c-3zeruj:hover{text-decoration-color:inherit;}@media (min-width:0px){.c-zjuml4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (min-width:600px){.c-zjuml4{display:none;}}.c-1dmadst{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;margin-right:-12px;color:inherit;padding:12px;font-size:1.75rem;}.c-1dmadst::-moz-focus-inner{border-style:none;}.c-1dmadst.Mui-disabled{pointer-events:none;cursor:default;}@media print{.c-1dmadst{-webkit-print-color-adjust:exact;color-adjust:exact;}}.c-1dmadst:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.c-1dmadst:hover{background-color:transparent;}}.c-1dmadst.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.c-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.c-i6s8oy{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.c-i6s8oy{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.c-i6s8oy{min-height:48px;}}}@media (min-width:600px){.c-i6s8oy{min-height:64px;}}.c-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.c-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.c-1qsxih2{max-width:1200px;}}.c-1yjvs5a{margin-bottom:32px;}.c-1n6wxgb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:8px 0px;}.c-1qh3bxa{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;margin-right:4px;}.c-16n8wpk{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.43;}.c-1ihubty{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1.5rem;line-height:1.334;margin-bottom:0.35em;}.c-ntfpy7{padding:0;margin:0;}.c-1vaygba{display:inline;padding:0;margin:0;}.c-1f5kc47{margin:0;color:rgba(0, 0, 0, 0.6);-webkit-text-decoration:none;text-decoration:none;}.c-1f5kc47:hover{-webkit-text-decoration:underline;text-decoration:underline;}.c-y25xid{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;margin-top:16px;margin-bottom:16px;text-align:justify;white-space:pre-line;}.c-ceho3e{padding:4px 8px;border-radius:4px;background-color:#1e1e1e;color:#d4d4d4;font-family:"SFMono-Regular",Consolas,Menlo,Courier,monospace,monospace;font-size:0.9em;}pre>.c-ceho3e{padding:0;background-color:transparent;}.c-1ugattu{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:2.125rem;line-height:1.235;margin-top:32px;margin-bottom:32px;border-bottom:1px solid currentcolor;}.c-15x2j1y{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1.5rem;line-height:1.334;margin-top:24px;margin-bottom:24px;}.c-14rm9aa{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);margin-top:16px;margin-bottom:16px;}.c-vlahzl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 32px;border-top-right-radius:5px;border-top-left-radius:5px;background-color:#555;color:white;}.c-1lky7cb{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;}.c-1yipi07{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;padding:5px;font-size:1.125rem;color:white;}.c-1yipi07::-moz-focus-inner{border-style:none;}.c-1yipi07.Mui-disabled{pointer-events:none;cursor:default;}@media print{.c-1yipi07{-webkit-print-color-adjust:exact;color-adjust:exact;}}.c-1yipi07:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.c-1yipi07:hover{background-color:transparent;}}.c-1yipi07.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.c-1k33q06{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.25rem;}.c-12ogyw6{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;overflow:auto;padding:8px 32px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;}.c-1f8td17{padding:4px 8px;border-radius:4px;background-color:#1e1e1e;color:#d4d4d4;font-family:"SFMono-Regular",Consolas,Menlo,Courier,monospace,monospace;font-size:0.9em;word-break:break-all;}pre>.c-1f8td17{padding:0;background-color:transparent;}.c-15kjgm{margin:0;color:#1976d2;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);}.c-15kjgm:hover{text-decoration-color:inherit;}.c-1aue7hj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:0;margin:32px 0px;}.c-1sl6rns{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 16px;margin:0;-webkit-flex:1;-ms-flex:1;flex:1;padding-left:0;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}.c-f7hjxq{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;color:#1976d2;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);}.c-f7hjxq:hover{text-decoration-color:inherit;}.c-1bhrv1p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 16px;margin:0;border-left:1px solid #6c6c6c;border-right:1px solid #6c6c6c;}.c-mpp38z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 16px;margin:0;-webkit-flex:1;-ms-flex:1;flex:1;padding-right:0;}.c-ze4krk{margin:32px auto;}.c-1jnynlu{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1.5rem;line-height:1.334;}.c-1rvtlej{list-style:none;padding:0;margin:0;}.c-116qoqd{padding:16px 24px;margin:16px 0px;border:1px solid #bbb;}.c-1d3ah2d{text-align:center;margin:32px 0px;}.c-fnf71d{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:1rem;line-height:1.5;margin-bottom:0.35em;}.c-19fxvs2{margin:0;font-family:游ゴシック体,YuGothic,游ゴシック,Yu Gothic,メイリオ,sans-serif;font-weight:500;font-size:0.875rem;line-height:1.43;color:#1976d2;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);}.c-19fxvs2:hover{text-decoration-color:inherit;}</style></head><body><div id="__next"><header amp-fx="float-in-top" class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation1 MuiAppBar-root MuiAppBar-colorDefault MuiAppBar-positionFixed mui-fixed c-1kyvigp"><div class="MuiContainer-root MuiContainer-maxWidthLg MuiToolbar-root MuiToolbar-regular c-1ghlunn"><div class="c-i9gxme"><div class="MuiTypography-root MuiTypography-h6 MuiTypography-noWrap c-1x6wkub"><a href="/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineNone c-1tqdl5x">Tech SANDBOX</a></div><p class="MuiTypography-root MuiTypography-body2 MuiTypography-noWrap c-wb6uyc">技術ブログ改め、Qiitaの下書き</p></div><nav class="MuiBox-root c-rntpfg"><a href="/" class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineAlways c-3zeruj">Blog</a><a href="https://github.com/iMasanari" target="_blank" rel="noopener" class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineAlways c-3zeruj">GitHub</a><a href="https://qiita.com/iMasanari" target="_blank" rel="noopener" class="MuiTypography-root MuiTypography-body1 MuiTypography-noWrap MuiLink-root MuiLink-underlineAlways c-3zeruj">Qiita</a></nav><div class="MuiBox-root c-zjuml4"><button tabIndex="0" type="button" aria-label="menu" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-edgeEnd MuiIconButton-sizeLarge c-1dmadst"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium c-vubbuv"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button></div></div></header><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular c-i6s8oy"></div><div class="MuiContainer-root MuiContainer-maxWidthLg c-1qsxih2"><article><div class="MuiBox-root c-1yjvs5a"><header><div class="c-1n6wxgb"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="CalendarTodayIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1qh3bxa"><path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"></path></svg><time dateTime="2020-11-28T08:05:18.607Z" class="MuiTypography-root MuiTypography-body2 c-16n8wpk">2020-11-28</time></div><h1 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom c-1ihubty">ブログをAMP対応（仮）しました</h1><ul class="c-ntfpy7"> <li class="c-1vaygba"><a href="/tags/AMP/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#AMP</a></li> <li class="c-1vaygba"><a href="/tags/Next.js" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#Next.js</a></li> <li class="c-1vaygba"><a href="/tags/blog/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#blog</a></li></ul></header></div><main><p class="MuiTypography-root MuiTypography-body1 c-y25xid">実質、各ページコンポーネントに <code class="c-ceho3e">export const config = { amp: 'hybrid' }</code> を追加しただけ。<br />
Next.js超ラク。</p>
<h2 class="MuiTypography-root MuiTypography-h4 c-1ugattu">AMPとは</h2>
<blockquote>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">Accelerated Mobile Pages (AMP) は、Googleが中心となって立ち上げた、モバイルでのウェブサイト閲覧を高速化することを目的とするオープンソースプロジェクトである。また、AMPの成果物である一連の仕様やライブラリなどについてもAMPと呼ぶ。AMPは、従来より用いられているHTMLなどのウェブ技術を改良したもので、中核となるのはAMP HTMLと呼ばれるHTMLの一種である。</p>
</blockquote>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">らしいです。Wikipadiaより引用。</p>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">ページの表示が遅くなる書き方を禁止するため、HTMLの書き方が制限されますが、代わりにAMPが用意したコンポーネントを使用できます。そして、AMPのルールに沿って書くことで、モバイル時にGoogle検索からページに入るときなどにAMP Cacheと呼ばれる専用のCDNから配信されるというメリットがあります。</p>
<h2 class="MuiTypography-root MuiTypography-h4 c-1ugattu">やったこと</h2>
<h3 class="MuiTypography-root MuiTypography-h5 c-15x2j1y">AMP設定の追加</h3>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">上記の通り、下記を追加しました。</p>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb"></span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #C586C0;">export</span><span style="color: #D4D4D4;"> </span><span style="color: #569CD6;">const</span><span style="color: #D4D4D4;"> </span><span style="color: #4FC1FF;">config</span><span style="color: #D4D4D4;"> = { </span><span style="color: #9CDCFE;">amp:</span><span style="color: #D4D4D4;"> </span><span style="color: #CE9178;">'hybrid'</span><span style="color: #D4D4D4;"> }</span></span></code></pre></div>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">上記の設定を追加することで、<code class="c-ceho3e">next export</code> 時に下記のようにファイルが出力されます。</p>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb"></span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #D4D4D4;">$ tree out/blog</span></span>
<span class="line"><span style="color: #D4D4D4;">out/blog</span></span>
<span class="line"><span style="color: #D4D4D4;">├── deploy-to-github-pages-user-page</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">├── deploy-to-github-pages-user-page.amp</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">├── difference-between-jsx-and-html</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">├── difference-between-jsx-and-html.amp</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">├── environment-construction</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">├── environment-construction.amp</span></span>
<span class="line"><span style="color: #D4D4D4;">│   └── index.html</span></span>
<span class="line"><span style="color: #D4D4D4;">...</span></span></code></pre></div>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">AMP時は <code class="c-ceho3e">{slug}.amp/index.html</code> に、非AMP時は <code class="c-ceho3e">{slug}/index.html</code> が使用されます。</p>
<h3 class="MuiTypography-root MuiTypography-h5 c-15x2j1y">グローバルCSSの読み込み方法の変更</h3>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">グローバルCSSをWebpackの <code class="c-1f8td17">import</code> 経由ではなく、styled-jsx + postcss-importで読み込むように変更しました。Webpackの <code class="c-1f8td17">import</code> だと、AMP時にうまく読み込まれないようです。</p>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">参考： <a href="https://github.com/vercel/next.js/issues/7121" target="_blank" rel="noopener" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways c-15kjgm">AMP: styles missing when importing standard css files in a project using styled components #7121</a></p>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb">diff: src/pages/_app.tsx</span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #CE9178;">-import 'mvp.css'</span></span>
<span class="line"><span style="color: #CE9178;">-import 'prismjs/themes/prism-okaidia.css'</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4;"> // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D4D4D4;"> &lt;style jsx global>{`</span></span>
<span class="line"><span style="color: #B5CEA8;">+  @import 'mvp.css';</span></span>
<span class="line"><span style="color: #B5CEA8;">+  @import 'prismjs/themes/prism-okaidia.css';</span></span>
<span class="line"><span style="color: #D4D4D4;">   /* ... */</span></span>
<span class="line"><span style="color: #D4D4D4;"> `}&lt;/style></span></span></code></pre></div>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb">diff: postcss.config.js</span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #D4D4D4;">module.exports = {</span></span>
<span class="line"><span style="color: #D4D4D4;">  plugins: {</span></span>
<span class="line"><span style="color: #D4D4D4;">    'postcss-custom-properties': {},</span></span>
<span class="line"><span style="color: #B5CEA8;">+   'postcss-import': {},</span></span>
<span class="line"><span style="color: #D4D4D4;">  },</span></span>
<span class="line"><span style="color: #D4D4D4;">}</span></span></code></pre></div>
<h3 class="MuiTypography-root MuiTypography-h5 c-15x2j1y">スタイル調整</h3>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">各ページのコンポーネントについて、非AMP時は <code class="c-ceho3e">&lt;div id=&quot;__next&quot;>...&lt;/div></code> の中に展開されますが、AMP時は <code class="c-1f8td17">body</code> 以下に直接展開されます。</p>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">現在このブログで使用しているCSSフレームワークの「mvp.css」に下記のようなスタイルがあったため、AMP時と非AMP時で表示に差異が出ていました。</p>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb">mvp.css</span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #6A9955;">/* 非AMP時のみ下記が適応されない */</span></span>
<span class="line"><span style="color: #D7BA7D;">article</span><span style="color: #D4D4D4;"> </span><span style="color: #D7BA7D;">header</span><span style="color: #D4D4D4;">, </span><span style="color: #D7BA7D;">div</span><span style="color: #D4D4D4;"> </span><span style="color: #D7BA7D;">header</span><span style="color: #D4D4D4;">, </span><span style="color: #D7BA7D;">main</span><span style="color: #D4D4D4;"> </span><span style="color: #D7BA7D;">header</span><span style="color: #D4D4D4;"> {</span></span>
<span class="line"><span style="color: #D4D4D4;">  </span><span style="color: #9CDCFE;">padding-top</span><span style="color: #D4D4D4;">: </span><span style="color: #B5CEA8;">0</span><span style="color: #D4D4D4;">;</span></span>
<span class="line"><span style="color: #D4D4D4;">}</span></span></code></pre></div>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">非AMP時でも同じ見た目になるよう、下記を追加しました。</p>
<div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 c-14rm9aa"><div class="c-vlahzl"><span class="MuiTypography-root MuiTypography-body1 c-1lky7cb">diff: src/components/organisms/Header.tsx</span><button tabIndex="0" type="button" aria-label="copy" class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeSmall c-1yipi07"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ContentCopyIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1k33q06"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></button></div><pre style="background-color: #1E1E1E;" class="MuiTypography-root MuiTypography-body1 shiki c-12ogyw6"><code class="c-ceho3e"><span class="line"><span style="color: #B5CEA8;">+&lt;style jsx>{`</span></span>
<span class="line"><span style="color: #B5CEA8;">+.Header {</span></span>
<span class="line"><span style="color: #B5CEA8;">+  padding-top: 0;</span></span>
<span class="line"><span style="color: #B5CEA8;">+}</span></span>
<span class="line"><span style="color: #B5CEA8;">+`}&lt;/style></span></span></code></pre></div>
<h2 class="MuiTypography-root MuiTypography-h4 c-1ugattu">やらなかったこと</h2>
<h3 class="MuiTypography-root MuiTypography-h5 c-15x2j1y">AMP Componentsの使用</h3>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">画像を使っていなかったので、<code class="c-ceho3e">amp-img</code> すら使っていないです。だからこそ、楽に対応できたというのもあります。<br />
AMP時と非AMP時の表示の切り替えなどもありません。</p>
<h2 class="MuiTypography-root MuiTypography-h4 c-1ugattu">まとめ</h2>
<p class="MuiTypography-root MuiTypography-body1 c-y25xid">シンプルなので、簡単にできました、という感じです。<br />
画像はそのうち対応したいです。</p></main></article><ul class="c-1aue7hj"><li class="c-1sl6rns"><a href="/blog/use-next/" class="MuiTypography-root MuiTypography-body1 MuiLink-root MuiLink-underlineAlways c-f7hjxq">ブログをNext.jsベースに変更した</a></li><li class="c-1bhrv1p"><a href="/" class="MuiTypography-root MuiTypography-body1 MuiLink-root MuiLink-underlineAlways c-f7hjxq">HOME</a></li><li class="c-mpp38z"><a href="/blog/mui-generate-class-name/" class="MuiTypography-root MuiTypography-body1 MuiLink-root MuiLink-underlineAlways c-f7hjxq">Material-UI v4の標準コンポーネントのクラス名を短縮してレンダリングする方法</a></li></ul><aside class="c-ze4krk"><header><h1 class="MuiTypography-root MuiTypography-h5 c-1jnynlu">同じタグを含む記事</h1><ul class="c-ntfpy7"> <li class="c-1vaygba"><a href="/tags/AMP/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#AMP</a></li> <li class="c-1vaygba"><a href="/tags/Next.js" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#Next.js</a></li> <li class="c-1vaygba"><a href="/tags/blog/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#blog</a></li></ul></header><main><ul class="c-1rvtlej"><li class="c-116qoqd"><article><header><div class="c-1n6wxgb"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="CalendarTodayIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1qh3bxa"><path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"></path></svg><time dateTime="2021-10-11T16:40:23.602Z" class="MuiTypography-root MuiTypography-body2 c-16n8wpk">2021-10-11</time></div><h1 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom c-1ihubty"><a href="/blog/mui-generate-class-name/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways c-15kjgm">Material-UI v4の標準コンポーネントのクラス名を短縮してレンダリングする方法</a></h1><ul class="c-ntfpy7"> <li class="c-1vaygba"><a href="/tags/MUI/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#MUI</a></li> <li class="c-1vaygba"><a href="/tags/Next.js" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#Next.js</a></li></ul></header></article></li><li class="c-116qoqd"><article><header><div class="c-1n6wxgb"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="CalendarTodayIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1qh3bxa"><path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"></path></svg><time dateTime="2020-09-20T06:33:49.199Z" class="MuiTypography-root MuiTypography-body2 c-16n8wpk">2020-09-20</time></div><h1 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom c-1ihubty"><a href="/blog/use-next/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways c-15kjgm">ブログをNext.jsベースに変更した</a></h1><ul class="c-ntfpy7"> <li class="c-1vaygba"><a href="/tags/React/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#React</a></li> <li class="c-1vaygba"><a href="/tags/Next.js" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#Next.js</a></li> <li class="c-1vaygba"><a href="/tags/blog/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#blog</a></li></ul></header></article></li><li class="c-116qoqd"><article><header><div class="c-1n6wxgb"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="CalendarTodayIcon" class="MuiSvgIcon-root MuiSvgIcon-fontSizeSmall c-1qh3bxa"><path d="M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 18H4V8h16v13z"></path></svg><time dateTime="2019-04-26T13:55:56.097Z" class="MuiTypography-root MuiTypography-body2 c-16n8wpk">2019-04-26</time></div><h1 class="MuiTypography-root MuiTypography-h5 MuiTypography-gutterBottom c-1ihubty"><a href="/blog/use-parcel/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways c-15kjgm">ブログ開発をParcelに変更した</a></h1><ul class="c-ntfpy7"> <li class="c-1vaygba"><a href="/tags/parcel/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#parcel</a></li> <li class="c-1vaygba"><a href="/tags/blog/" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineHover c-1f5kc47">#blog</a></li></ul></header></article></li></ul></main></aside></div><footer class="c-1d3ah2d"><div class="MuiContainer-root MuiContainer-maxWidthLg c-1qsxih2"><p class="MuiTypography-root MuiTypography-body1 MuiTypography-gutterBottom c-fnf71d">Author: <a href="https://github.com/iMasanari" class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways c-15kjgm">iMasanari</a></p><a href="https://github.com/iMasanari/imasanari.github.io/" class="MuiTypography-root MuiTypography-body2 MuiLink-root MuiLink-underlineAlways c-19fxvs2">Show on GitHub</a></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"ブログをAMP対応（仮）しました","description":"実質、各ページに `export const config = { amp: 'hybrid' }` を追加しただけ。next.js超ラク。","slug":"use-amp","tags":["AMP","Next.js","blog"],"date":"2020-11-28T08:05:18.607Z","update":null,"image":null,"draft":false},"next":{"title":"Material-UI v4の標準コンポーネントのクラス名を短縮してレンダリングする方法","description":"Material-UI v4で標準コンポーネントのクラス名を短縮するには、`createGenerateClassName` を使用します。このページでは、その `createGenerateClassName` の設定方法を紹介します。","slug":"mui-generate-class-name","tags":["MUI","Next.js"],"date":"2021-10-11T16:40:23.602Z","update":null,"image":null,"draft":false},"prev":{"title":"ブログをNext.jsベースに変更した","description":"","slug":"use-next","tags":["React","Next.js","blog"],"date":"2020-09-20T06:33:49.199Z","update":null,"image":null,"draft":false},"sameTags":[{"title":"Material-UI v4の標準コンポーネントのクラス名を短縮してレンダリングする方法","description":"Material-UI v4で標準コンポーネントのクラス名を短縮するには、`createGenerateClassName` を使用します。このページでは、その `createGenerateClassName` の設定方法を紹介します。","slug":"mui-generate-class-name","tags":["MUI","Next.js"],"date":"2021-10-11T16:40:23.602Z","update":null,"image":null,"draft":false},{"title":"ブログをNext.jsベースに変更した","description":"","slug":"use-next","tags":["React","Next.js","blog"],"date":"2020-09-20T06:33:49.199Z","update":null,"image":null,"draft":false},{"title":"ブログ開発をParcelに変更した","description":"前回の記事でparcelを使用して便利だったので、このブログのモジュールバンドラをparcelに変更した。決め手は、Tree Shakingがサポートされていたから。","slug":"use-parcel","tags":["parcel","blog"],"date":"2019-04-26T13:55:56.097Z","update":null,"image":null,"draft":false}],"content":"\u003cp\u003e実質、各ページコンポーネントに \u003ccode\u003eexport const config = { amp: 'hybrid' }\u003c/code\u003e を追加しただけ。\u003cbr\u003e\nNext.js超ラク。\u003c/p\u003e\n\u003ch2\u003eAMPとは\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAccelerated Mobile Pages (AMP) は、Googleが中心となって立ち上げた、モバイルでのウェブサイト閲覧を高速化することを目的とするオープンソースプロジェクトである。また、AMPの成果物である一連の仕様やライブラリなどについてもAMPと呼ぶ。AMPは、従来より用いられているHTMLなどのウェブ技術を改良したもので、中核となるのはAMP HTMLと呼ばれるHTMLの一種である。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eらしいです。Wikipadiaより引用。\u003c/p\u003e\n\u003cp\u003eページの表示が遅くなる書き方を禁止するため、HTMLの書き方が制限されますが、代わりにAMPが用意したコンポーネントを使用できます。そして、AMPのルールに沿って書くことで、モバイル時にGoogle検索からページに入るときなどにAMP Cacheと呼ばれる専用のCDNから配信されるというメリットがあります。\u003c/p\u003e\n\u003ch2\u003eやったこと\u003c/h2\u003e\n\u003ch3\u003eAMP設定の追加\u003c/h3\u003e\n\u003cp\u003e上記の通り、下記を追加しました。\u003c/p\u003e\n\u003capp-code-wrapper lang=\"js\" code=\"export const config = { amp: \u0026#x27;hybrid\u0026#x27; }\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #C586C0\"\u003eexport\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #569CD6\"\u003econst\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #4FC1FF\"\u003econfig\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e = { \u003c/span\u003e\u003cspan style=\"color: #9CDCFE\"\u003eamp:\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #CE9178\"\u003e\u0026#39;hybrid\u0026#39;\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e }\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003cp\u003e上記の設定を追加することで、\u003ccode\u003enext export\u003c/code\u003e 時に下記のようにファイルが出力されます。\u003c/p\u003e\n\u003capp-code-wrapper lang=\"bash\" code=\"$ tree out/blog\nout/blog\n├── deploy-to-github-pages-user-page\n│   └── index.html\n├── deploy-to-github-pages-user-page.amp\n│   └── index.html\n├── difference-between-jsx-and-html\n│   └── index.html\n├── difference-between-jsx-and-html.amp\n│   └── index.html\n├── environment-construction\n│   └── index.html\n├── environment-construction.amp\n│   └── index.html\n...\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e$ tree out/blog\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003eout/blog\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── deploy-to-github-pages-user-page\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── deploy-to-github-pages-user-page.amp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── difference-between-jsx-and-html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── difference-between-jsx-and-html.amp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── environment-construction\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e├── environment-construction.amp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e│   └── index.html\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e...\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003cp\u003eAMP時は \u003ccode\u003e{slug}.amp/index.html\u003c/code\u003e に、非AMP時は \u003ccode\u003e{slug}/index.html\u003c/code\u003e が使用されます。\u003c/p\u003e\n\u003ch3\u003eグローバルCSSの読み込み方法の変更\u003c/h3\u003e\n\u003cp\u003eグローバルCSSをWebpackの \u003ccode\u003eimport\u003c/code\u003e 経由ではなく、styled-jsx + postcss-importで読み込むように変更しました。Webpackの \u003ccode\u003eimport\u003c/code\u003e だと、AMP時にうまく読み込まれないようです。\u003c/p\u003e\n\u003cp\u003e参考： \u003ca href=\"https://github.com/vercel/next.js/issues/7121\"\u003eAMP: styles missing when importing standard css files in a project using styled components #7121\u003c/a\u003e\u003c/p\u003e\n\u003capp-code-wrapper title=\"src/pages/_app.tsx\" lang=\"diff\" code=\"-import \u0026#x27;mvp.css\u0026#x27;\n-import \u0026#x27;prismjs/themes/prism-okaidia.css\u0026#x27;\n\n // ...\n\n \u003cstyle jsx global\u003e{\u0026#x60;\n+  @import \u0026#x27;mvp.css\u0026#x27;;\n+  @import \u0026#x27;prismjs/themes/prism-okaidia.css\u0026#x27;;\n   /* ... */\n \u0026#x60;}\u003c/style\u003e\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #CE9178\"\u003e-import \u0026#39;mvp.css\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #CE9178\"\u003e-import \u0026#39;prismjs/themes/prism-okaidia.css\u0026#39;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e // ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u0026lt;style jsx global\u0026gt;{`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+  @import \u0026#39;mvp.css\u0026#39;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+  @import \u0026#39;prismjs/themes/prism-okaidia.css\u0026#39;;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e   /* ... */\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e `}\u0026lt;/style\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003capp-code-wrapper title=\"postcss.config.js\" lang=\"diff\" code=\"module.exports = {\n  plugins: {\n    \u0026#x27;postcss-custom-properties\u0026#x27;: {},\n+   \u0026#x27;postcss-import\u0026#x27;: {},\n  },\n}\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003emodule.exports = {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e  plugins: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e    \u0026#39;postcss-custom-properties\u0026#39;: {},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+   \u0026#39;postcss-import\u0026#39;: {},\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e  },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003ch3\u003eスタイル調整\u003c/h3\u003e\n\u003cp\u003e各ページのコンポーネントについて、非AMP時は \u003ccode\u003e\u0026#x3C;div id=\"__next\"\u003e...\u0026#x3C;/div\u003e\u003c/code\u003e の中に展開されますが、AMP時は \u003ccode\u003ebody\u003c/code\u003e 以下に直接展開されます。\u003c/p\u003e\n\u003cp\u003e現在このブログで使用しているCSSフレームワークの「mvp.css」に下記のようなスタイルがあったため、AMP時と非AMP時で表示に差異が出ていました。\u003c/p\u003e\n\u003capp-code-wrapper title=\"mvp.css\" lang=\"css\" code=\"/* 非AMP時のみ下記が適応されない */\narticle header, div header, main header {\n  padding-top: 0;\n}\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A9955\"\u003e/* 非AMP時のみ下記が適応されない */\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D7BA7D\"\u003earticle\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D7BA7D\"\u003eheader\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #D7BA7D\"\u003ediv\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D7BA7D\"\u003eheader\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #D7BA7D\"\u003emain\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D7BA7D\"\u003eheader\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #9CDCFE\"\u003epadding-top\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e: \u003c/span\u003e\u003cspan style=\"color: #B5CEA8\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #D4D4D4\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D4D4D4\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003cp\u003e非AMP時でも同じ見た目になるよう、下記を追加しました。\u003c/p\u003e\n\u003capp-code-wrapper title=\"src/components/organisms/Header.tsx\" lang=\"diff\" code=\"+\u003cstyle jsx\u003e{\u0026#x60;\n+.Header {\n+  padding-top: 0;\n+}\n+\u0026#x60;}\u003c/style\u003e\"\u003e\u003cpre class=\"shiki\" style=\"background-color: #1E1E1E\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+\u0026lt;style jsx\u0026gt;{`\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+.Header {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+  padding-top: 0;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #B5CEA8\"\u003e+`}\u0026lt;/style\u0026gt;\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/app-code-wrapper\u003e\n\u003ch2\u003eやらなかったこと\u003c/h2\u003e\n\u003ch3\u003eAMP Componentsの使用\u003c/h3\u003e\n\u003cp\u003e画像を使っていなかったので、\u003ccode\u003eamp-img\u003c/code\u003e すら使っていないです。だからこそ、楽に対応できたというのもあります。\u003cbr\u003e\nAMP時と非AMP時の表示の切り替えなどもありません。\u003c/p\u003e\n\u003ch2\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eシンプルなので、簡単にできました、という感じです。\u003cbr\u003e\n画像はそのうち対応したいです。\u003c/p\u003e"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"use-amp"},"buildId":"JVZsEND74mb34NnMWClVv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>