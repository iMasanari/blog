{"pageProps":{"post":{"title":"React StaticでTypeScriptを使用した時のエラー対処法","description":"static.config.jsのwebpack設定を変更することで起こるエラーの対処法。","slug":"webpacks-rules-in-static-config-js","tags":["ReactStatic","TypeScript","webpack"],"date":"2018-07-03T11:47:13.910Z"},"next":{"title":"ブログをHyperappベースの自作ジェネレータに変更した話","description":"作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。","slug":"use-hyperapp","tags":["blog","Hyperapp"],"image":"/images/hyperapp.png","date":"2018-07-12T12:45:07.379Z"},"prev":{"title":"GitHub PagesのUser Pageにdistフォルダをデプロイする","description":"User Pageにはmasterブランチしか指定できないようです。そこに任意のフォルダの中身をデプロイする方法を書きました。","slug":"deploy-to-github-pages-user-page","tags":["GitHubPages"],"date":"2018-07-01T15:11:38.719Z","update":"2018-07-02T13:49:48.876Z"},"sameTags":[{"title":"Rust + wasm-bindgen + WebWorkerの環境構築","description":"WebAssembly Advent Calendar 2018の20日目の記事。","slug":"wasm-bindgen-with-worker","tags":["Rust","wasm-bindgen","TypeScript","parcel"],"date":"2018-12-20T14:58:37.388Z","update":"2019-04-20T13:15:27.878Z"},{"title":"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する","description":"ブログを作る前、Qiitaに投稿しようと書いていたけど途中でやめ、最近まで忘れていた記事です。Qiitaでもいいけど、せっかくだからこっちに置いておきます。","slug":"remove-object-key","tags":["JavaScript","Babel","TypeScript"],"date":"2018-07-13T12:47:36.148Z"},{"title":"ブログで使用した技術","description":"この技術ブログで使用したライブラリやツールを紹介していきます。選定理由についても書きました。","slug":"use-technology","tags":["blog","React","preact","TypeScript","ReactStatic"],"date":"2018-06-30T14:52:29.225Z","update":"2019-04-20T13:15:27.878Z"}],"content":"<h2>rulesを変更して<code>npm run build</code>するとエラーに</h2>\n<p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。\nサンプルは開発中（<code>npm run start</code>）では問題はないが、プロダクションビルド（<code>npm run build</code>）するとエラーになるのでその対処法をメモして置く。</p>\n<pre class=\"shiki\" style=\"background-color: #1E1E1E\"><code><span class=\"line\"><span style=\"color: #D4D4D4\">$ npm run build</span></span>\n<span class=\"line\"><span style=\"color: #6A9955\"># ...</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">Error: Module build failed: Error: </span><span style=\"color: #CE9178\">\"extract-text-webpack-plugin\"</span><span style=\"color: #D4D4D4\"> loader is used </span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">without the  corresponding plugin, refer to </span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">https://github.com/webpack/extract-text-webpack-plugin </span><span style=\"color: #C586C0\">for</span><span style=\"color: #D4D4D4\"> th  e usage example</span></span>\n<span class=\"line\"></span></code></pre>\n<p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p>\n<pre class=\"shiki\" style=\"background-color: #1E1E1E\"><code><span class=\"line\"><span style=\"color: #6A9955\">// static.config.js</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C586C0\">export</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #C586C0\">default</span><span style=\"color: #D4D4D4\"> {</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  </span><span style=\"color: #6A9955\">// ...</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  </span><span style=\"color: #DCDCAA\">webpack</span><span style=\"color: #9CDCFE\">:</span><span style=\"color: #D4D4D4\"> (</span><span style=\"color: #9CDCFE\">config</span><span style=\"color: #D4D4D4\">, { </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\"> }) </span><span style=\"color: #569CD6\">=></span><span style=\"color: #D4D4D4\"> {</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span><span style=\"color: #9CDCFE\">config</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">module</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">rules</span><span style=\"color: #D4D4D4\"> = [{</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      </span><span style=\"color: #9CDCFE\">oneOf:</span><span style=\"color: #D4D4D4\"> [</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        </span><span style=\"color: #6A9955\">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">jsLoader</span><span style=\"color: #D4D4D4\">,</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">cssLoader</span><span style=\"color: #D4D4D4\">,</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">fileLoader</span><span style=\"color: #D4D4D4\">,</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      ],</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    }]</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span><span style=\"color: #C586C0\">return</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #9CDCFE\">config</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  }</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>デフォルトとは一体…</p>\n<p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。\n<code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p>\n<h2>暫定的対処法</h2>\n<p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。\nルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p>\n<pre class=\"shiki\" style=\"background-color: #1E1E1E\"><code><span class=\"line\"><span style=\"color: #6A9955\">// static.config.js</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C586C0\">export</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #C586C0\">default</span><span style=\"color: #D4D4D4\"> {</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  </span><span style=\"color: #6A9955\">// ...</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  </span><span style=\"color: #DCDCAA\">webpack</span><span style=\"color: #9CDCFE\">:</span><span style=\"color: #D4D4D4\"> (</span><span style=\"color: #9CDCFE\">config</span><span style=\"color: #D4D4D4\">, { </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\"> }) </span><span style=\"color: #569CD6\">=></span><span style=\"color: #D4D4D4\"> {</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span><span style=\"color: #9CDCFE\">config</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">resolve</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">extensions</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #DCDCAA\">push</span><span style=\"color: #D4D4D4\">(</span><span style=\"color: #CE9178\">'.ts'</span><span style=\"color: #D4D4D4\">, </span><span style=\"color: #CE9178\">'.tsx'</span><span style=\"color: #D4D4D4\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span><span style=\"color: #9CDCFE\">config</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">module</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">rules</span><span style=\"color: #D4D4D4\">[</span><span style=\"color: #B5CEA8\">0</span><span style=\"color: #D4D4D4\">].</span><span style=\"color: #9CDCFE\">oneOf</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #DCDCAA\">unshift</span><span style=\"color: #D4D4D4\">({</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      </span><span style=\"color: #9CDCFE\">test:</span><span style=\"color: #D16969\"> /</span><span style=\"color: #D7BA7D\">\\.</span><span style=\"color: #CE9178\">(</span><span style=\"color: #D16969\">js</span><span style=\"color: #DCDCAA\">|</span><span style=\"color: #D16969\">jsx</span><span style=\"color: #DCDCAA\">|</span><span style=\"color: #D16969\">ts</span><span style=\"color: #DCDCAA\">|</span><span style=\"color: #D16969\">tsx</span><span style=\"color: #CE9178\">)</span><span style=\"color: #DCDCAA\">$</span><span style=\"color: #D16969\">/</span><span style=\"color: #D4D4D4\">,</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      </span><span style=\"color: #9CDCFE\">exclude:</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #9CDCFE\">defaultLoaders</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">jsLoader</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #9CDCFE\">exclude</span><span style=\"color: #D4D4D4\">, </span><span style=\"color: #6A9955\">// as std jsLoader exclude</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      </span><span style=\"color: #9CDCFE\">use:</span><span style=\"color: #D4D4D4\"> [</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        { </span><span style=\"color: #9CDCFE\">loader:</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #CE9178\">'babel-loader'</span><span style=\"color: #D4D4D4\"> },</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        {</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">          </span><span style=\"color: #9CDCFE\">loader:</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #9CDCFE\">require</span><span style=\"color: #D4D4D4\">.</span><span style=\"color: #DCDCAA\">resolve</span><span style=\"color: #D4D4D4\">(</span><span style=\"color: #CE9178\">'ts-loader'</span><span style=\"color: #D4D4D4\">),</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">          </span><span style=\"color: #9CDCFE\">options:</span><span style=\"color: #D4D4D4\"> { </span><span style=\"color: #9CDCFE\">transpileOnly:</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #569CD6\">true</span><span style=\"color: #D4D4D4\"> },</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">        },</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">      ],</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    })</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">    </span><span style=\"color: #C586C0\">return</span><span style=\"color: #D4D4D4\"> </span><span style=\"color: #9CDCFE\">config</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">  },</span></span>\n<span class=\"line\"><span style=\"color: #D4D4D4\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>現在はこのような設定になっている。\nあまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>"},"__N_SSG":true}