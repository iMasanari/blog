{"pageProps":{"post":{"title":"React StaticでTypeScriptを使用した時のエラー対処法","description":"static.config.jsのwebpack設定を変更することで起こるエラーの対処法。","slug":"webpacks-rules-in-static-config-js","tags":["ReactStatic","TypeScript","webpack"],"date":"2018-07-03T11:47:13.910Z","body":"<h2 id=\"rulesを変更してnpm-run-buildするとエラーに\">rulesを変更して<code>npm run build</code>するとエラーに</h2><p>このブログはReact StaticのTypeScriptのexsampleがベースになっている。\nサンプルは開発中（<code>npm run start</code>）では問題はないが、プロダクションビルド（<code>npm run build</code>）するとエラーになるのでその対処法をメモして置く。</p><pre><code class=\"language-bash\" data-language=\"bash\" data-highlighted-line-numbers=\"\">$ <span class=\"token function\">npm</span> run build\n<span class=\"token comment\"># ...</span>\nError: Module build failed: Error: <span class=\"token string\">\"extract-text-webpack-plugin\"</span> loader is used \nwithout the  corresponding plugin, refer to \nhttps://github.com/webpack/extract-text-webpack-plugin <span class=\"token keyword\">for</span> th  e usage example\n</code></pre><p>サンプルの初期コードどころか、そもそも下記の設定で動かなかった。</p><pre><code class=\"language-jsx\" data-language=\"jsx\" data-highlighted-line-numbers=\"\"><span class=\"token comment\">// static.config.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function-variable function\">webpack</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> defaultLoaders <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      oneOf<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// ↓tsの設定を無くしデフォルトのを使用するもエラー継続</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>jsLoader<span class=\"token punctuation\">,</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>cssLoader<span class=\"token punctuation\">,</span>\n        defaultLoaders<span class=\"token punctuation\">.</span>fileLoader<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    \n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><p>デフォルトとは一体…</p><p><code>config.module.rules</code>を変更しない場合は問題なくビルドすることができる。\n<code>defaultLoaders.cssLoader</code>が悪さをしているようだ。</p><h2 id=\"暫定的対処法\">暫定的対処法</h2><p><code>defaultLoaders.cssLoader</code>を使わず、既存のルールの先頭に追加したい処理を置く。\nルールは<code>oneOf</code>で書かれているため、最初に一致するルールのみが使用される。先頭に追加することで、既存のルールは変更することなくマイルールを適用することができるのだ。</p><pre><code class=\"language-jsx\" data-language=\"jsx\" data-highlighted-line-numbers=\"\"><span class=\"token comment\">// static.config.js</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token function-variable function\">webpack</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> defaultLoaders <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">)</span>\n\n    config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>oneOf<span class=\"token punctuation\">.</span><span class=\"token function\">unshift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      test<span class=\"token operator\">:</span> <span class=\"token regex\">/\\.(js|jsx|ts|tsx)$/</span><span class=\"token punctuation\">,</span>\n      exclude<span class=\"token operator\">:</span> defaultLoaders<span class=\"token punctuation\">.</span>jsLoader<span class=\"token punctuation\">.</span>exclude<span class=\"token punctuation\">,</span> <span class=\"token comment\">// as std jsLoader exclude</span>\n      use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> loader<span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n          loader<span class=\"token operator\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ts-loader'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> transpileOnly<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> config\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><p>現在はこのような設定になっている。\nあまり気に入った方法ではないが、しばらくはこれで様子を見ることにする。</p>"},"next":{"title":"ブログをHyperappベースの自作ジェネレータに変更した話","description":"作ったばかりのこのブログだが、Hyperappで動くstaticでSPAなサイトに変更した。React Staticを使用していた時とは違って、HTMLの書き出しなどは自分で処理を行っている。まだ未完成な機能もあるが、ビルド後のJavaScriptが約8KBと軽量で気に入っている。","slug":"use-hyperapp","tags":["blog","Hyperapp"],"image":"/images/hyperapp.png","date":"2018-07-12T12:45:07.379Z"},"prev":{"title":"GitHub PagesのUser Pageにdistフォルダをデプロイする","description":"User Pageにはmasterブランチしか指定できないようです。そこに任意のフォルダの中身をデプロイする方法を書きました。","slug":"deploy-to-github-pages-user-page","tags":["GitHubPages"],"date":"2018-07-01T15:11:38.719Z","update":"2018-07-02T13:49:48.876Z"},"sameTags":[{"title":"Rust + wasm-bindgen + WebWorkerの環境構築","description":"WebAssembly Advent Calendar 2018の20日目の記事。","slug":"wasm-bindgen-with-worker","tags":["Rust","wasm-bindgen","TypeScript","parcel"],"date":"2018-12-20T14:58:37.388Z","update":"2019-04-20T13:15:27.878Z"},{"title":"【ES.next】Objectから任意のキーを削除した新しいObjectを作成する","description":"ブログを作る前、Qiitaに投稿しようと書いていたけど途中でやめ、最近まで忘れていた記事です。Qiitaでもいいけど、せっかくだからこっちに置いておきます。","slug":"remove-object-key","tags":["JavaScript","Babel","TypeScript"],"date":"2018-07-13T12:47:36.148Z"},{"title":"ブログで使用した技術","description":"この技術ブログで使用したライブラリやツールを紹介していきます。選定理由についても書きました。","slug":"use-technology","tags":["blog","React","preact","TypeScript","ReactStatic"],"date":"2018-06-30T14:52:29.225Z","update":"2019-04-20T13:15:27.878Z"}]},"__N_SSG":true}